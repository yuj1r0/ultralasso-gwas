<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraLasso | GPU-Accelerated Genome-Wide Sparse Regression</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #111111;
            --bg-card: #0d0d0d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #666666;
            --orange-primary: #ff6b00;
            --orange-secondary: #ff8c38;
            --orange-dim: #cc5500;
            --orange-glow: rgba(255, 107, 0, 0.15);
            --border-color: #1a1a1a;
            --border-highlight: #2a2a2a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            font-size: 14px;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(180deg, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.8) 80%, transparent 100%);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            color: var(--orange-primary);
            font-weight: 700;
            font-size: 1.2rem;
            letter-spacing: 2px;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.75rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--orange-primary);
        }

        /* Slide sections */
        .slide {
            min-height: 100vh;
            padding: 8rem 4rem 4rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            border-bottom: 1px solid var(--border-color);
        }

        .slide::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--orange-dim), transparent);
            opacity: 0.3;
        }

        .slide-content {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Title slide - CENTERED */
        .title-slide {
            text-align: center;
            background: radial-gradient(ellipse at center, var(--orange-glow) 0%, transparent 70%);
        }

        .title-slide .slide-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .title-slide h1 {
            font-size: 4rem;
            font-weight: 700;
            color: var(--orange-primary);
            margin-bottom: 0.5rem;
            letter-spacing: 4px;
            text-shadow: 0 0 60px rgba(255, 107, 0, 0.3);
        }

        .title-slide .acronym {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
            text-align: center;
        }

        .title-slide .acronym span {
            color: var(--orange-primary);
            font-weight: 600;
        }

        .title-slide .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 3rem;
            letter-spacing: 1px;
            text-align: center;
        }

        .title-slide .authors {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 4rem;
            text-align: center;
        }

        .key-results {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            margin-top: 3rem;
            width: 100%;
            max-width: 1000px;
        }

        .result-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 2rem;
            text-align: center;
            transition: all 0.3s;
        }

        .result-card:hover {
            border-color: var(--orange-dim);
            transform: translateY(-4px);
            box-shadow: 0 10px 40px rgba(255, 107, 0, 0.1);
        }

        .result-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--orange-primary);
            margin-bottom: 0.5rem;
        }

        .result-card .label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Section headers */
        h2 {
            font-size: 2rem;
            font-weight: 600;
            color: var(--orange-primary);
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--orange-dim);
            display: inline-block;
        }

        h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--orange-secondary);
            margin: 2rem 0 1rem;
        }

        h4 {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
            margin: 1.5rem 0 0.75rem;
        }

        /* Text */
        p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            max-width: 900px;
        }

        strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        em {
            color: var(--text-muted);
            font-style: italic;
        }

        /* Code blocks */
        pre {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-left: 3px solid var(--orange-primary);
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        code {
            color: var(--orange-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        pre code {
            color: var(--text-secondary);
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-size: 0.85rem;
        }

        th {
            background: var(--bg-tertiary);
            color: var(--orange-primary);
            text-align: left;
            padding: 1rem;
            border: 1px solid var(--border-color);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.75rem;
        }

        td {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        tr:hover td {
            background: var(--bg-secondary);
        }

        /* ASCII diagrams - FIXED */
        .diagram {
            background: var(--bg-primary);
            border: 1px solid var(--orange-dim);
            padding: 1.5rem;
            margin: 2rem 0;
            overflow-x: auto;
            font-size: 0.75rem;
            line-height: 1.3;
            color: var(--orange-secondary);
            position: relative;
            white-space: pre;
            font-family: 'JetBrains Mono', monospace;
        }

        .diagram::before {
            content: '┌─ DIAGRAM';
            position: absolute;
            top: -0.7rem;
            left: 1rem;
            background: var(--bg-primary);
            padding: 0 0.5rem;
            color: var(--orange-dim);
            font-size: 0.7rem;
            white-space: nowrap;
        }

        /* Lists */
        ul, ol {
            margin: 1rem 0 1rem 1.5rem;
            color: var(--text-secondary);
        }

        li {
            margin: 0.5rem 0;
            padding-left: 0.5rem;
        }

        li::marker {
            color: var(--orange-primary);
        }

        /* Inline highlights */
        .highlight {
            color: var(--orange-primary);
            font-weight: 500;
        }

        /* Section number */
        .section-num {
            display: inline-block;
            width: 2.5rem;
            height: 2.5rem;
            line-height: 2.5rem;
            text-align: center;
            background: var(--orange-primary);
            color: var(--bg-primary);
            font-weight: 700;
            margin-right: 1rem;
            font-size: 1rem;
        }

        /* Blockquote */
        blockquote {
            border-left: 3px solid var(--orange-primary);
            padding: 1rem 1.5rem;
            margin: 2rem 0;
            background: var(--orange-glow);
            color: var(--text-primary);
            font-style: italic;
        }

        /* Formula blocks */
        .formula {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-highlight);
            padding: 1.5rem 2rem;
            margin: 1.5rem 0;
            text-align: center;
            font-size: 1rem;
            color: var(--orange-secondary);
        }

        /* Grid layouts */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin: 2rem 0;
        }

        .three-col {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .four-col {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin: 2rem 0;
        }

        /* Metric box */
        .metric-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            text-align: center;
        }

        .metric-box .value {
            font-size: 2.5rem;
            color: var(--orange-primary);
            font-weight: 700;
        }

        .metric-box .label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }

        .metric-box.small .value {
            font-size: 1.5rem;
        }

        /* Progress bars */
        .progress-item {
            margin: 1rem 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--orange-dim), var(--orange-primary));
        }

        /* Pipeline visualization */
        .pipeline {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin: 2rem 0;
        }

        .pipeline-stage {
            display: flex;
            align-items: stretch;
            position: relative;
        }

        .pipeline-label {
            width: 120px;
            flex-shrink: 0;
            padding: 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--orange-primary);
            font-weight: 600;
        }

        .pipeline-content {
            flex: 1;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-left: none;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .pipeline-box {
            background: var(--bg-primary);
            border: 2px solid var(--orange-dim);
            padding: 1rem 1.5rem;
            text-align: center;
            min-width: 150px;
        }

        .pipeline-box.highlight-box {
            border-color: var(--orange-primary);
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.2);
        }

        .pipeline-box .box-title {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .pipeline-box .box-value {
            font-size: 1rem;
            color: var(--orange-primary);
            font-weight: 600;
        }

        .pipeline-arrow {
            color: var(--orange-primary);
            font-size: 1.5rem;
            padding: 0 0.5rem;
        }

        /* Comparison boxes */
        .comparison {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 2rem;
            margin: 2rem 0;
            align-items: start;
        }

        .comparison-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
        }

        .comparison-box.bad {
            border-color: #ff4444;
        }

        .comparison-box.good {
            border-color: var(--orange-primary);
        }

        .comparison-box h4 {
            margin-top: 0;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .comparison-box.bad h4 {
            color: #ff6666;
        }

        .comparison-box.good h4 {
            color: var(--orange-primary);
        }

        .comparison-vs {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--text-muted);
            font-weight: 700;
        }

        .comparison-box ol {
            margin-left: 1.2rem;
        }

        .comparison-box li {
            margin: 0.75rem 0;
            font-size: 0.85rem;
        }

        /* Flow steps */
        .flow-step {
            display: flex;
            align-items: center;
            margin: 0.5rem 0;
            font-size: 0.85rem;
        }

        .flow-step .step-num {
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            background: var(--orange-dim);
            color: var(--bg-primary);
            font-size: 0.7rem;
            font-weight: 700;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .flow-step.bottleneck .step-num {
            background: #ff4444;
        }

        .flow-step.fast .step-num {
            background: var(--orange-primary);
        }

        /* Manhattan plot container */
        .manhattan-container {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            padding: 1rem;
            margin: 1.5rem 0;
            position: relative;
        }

        .manhattan-container::before {
            content: '┌─ MANHATTAN PLOT';
            position: absolute;
            top: -0.7rem;
            left: 1rem;
            background: var(--bg-primary);
            padding: 0 0.5rem;
            color: var(--orange-dim);
            font-size: 0.7rem;
        }

        #manhattan-canvas {
            width: 100%;
            height: 300px;
            display: block;
        }

        .qq-container {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            padding: 1rem;
            margin: 1.5rem 0;
            position: relative;
        }

        .qq-container::before {
            content: '┌─ QQ PLOT';
            position: absolute;
            top: -0.7rem;
            left: 1rem;
            background: var(--bg-primary);
            padding: 0 0.5rem;
            color: var(--orange-dim);
            font-size: 0.7rem;
        }

        #qq-canvas {
            width: 100%;
            height: 200px;
            display: block;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--orange-dim);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--orange-primary);
        }

        /* Appendix styles */
        .glossary-grid {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 0.5rem 2rem;
            margin: 1rem 0;
        }

        .glossary-term {
            color: var(--orange-primary);
            font-weight: 600;
        }

        .glossary-def {
            color: var(--text-secondary);
        }

        /* Animation */
        @keyframes glow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .pulse {
            animation: glow 2s ease-in-out infinite;
        }

        /* Footer - CENTERED */
        footer {
            padding: 4rem;
            text-align: center;
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        footer .logo {
            margin-bottom: 1rem;
        }

        footer p {
            text-align: center;
            max-width: none;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .slide {
                padding: 6rem 2rem 3rem;
            }

            .title-slide h1 {
                font-size: 2.5rem;
            }

            .key-results {
                grid-template-columns: repeat(2, 1fr);
            }

            .two-col, .three-col, .four-col, .comparison {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }

            h2 {
                font-size: 1.5rem;
            }

            .pipeline-stage {
                flex-direction: column;
            }

            .pipeline-label {
                width: 100%;
            }

            .pipeline-content {
                border-left: 1px solid var(--border-color);
                border-top: none;
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>

<nav>
    <div class="logo">ULTRALASSO</div>
    <div class="nav-links">
        <a href="#pipeline">Pipeline</a>
        <a href="#gwas">GWAS</a>
        <a href="#scaling">Scaling</a>
        <a href="#multi-pheno">Multi-Pheno</a>
        <a href="#results">Results</a>
    </div>
</nav>

<!-- Title Slide -->
<section class="slide title-slide">
    <div class="slide-content">
        <h1>UltraLasso</h1>
        <p class="acronym">
            <span>U</span>ltra-fast <span>L</span>arge-scale <span>T</span>ensor-accelerated <span>R</span>egression <span>A</span>rchitecture based on <span>LASSO</span>
        </p>
        <p class="subtitle">GPU-native mixed model large-scale GWAS in minutes, not hours</p>
        <p class="authors">
            <strong>Tuomo Kiiskinen, Josh Richland</strong> et al. <br>
            January 2026 · Version 3.0
        </p>

        <div class="key-results">
            <div class="result-card">
                <div class="value">8 min</div>
                <div class="label">Full GWAS Runtime</div>
            </div>
            <div class="result-card">
                <div class="value">862</div>
                <div class="label">Independent Loci</div>
            </div>
            <div class="result-card">
                <div class="value">336K</div>
                <div class="label">Samples</div>
            </div>
            <div class="result-card">
                <div class="value">6.8M</div>
                <div class="label">Variants Tested</div>
            </div>
        </div>
    </div>
</section>

<!-- GWAS Results Section -->
<section class="slide" id="gwas">
    <div class="slide-content">
        <h2><span class="section-num">★</span>GPU-Native GWAS: Validated Results</h2>

        <p>Complete LOCO-based GWAS pipeline validated on UK Biobank height (INI50) with <strong>336,442 samples</strong> and <strong>6.8M imputed variants</strong>. LDSC validation confirms ~10% confounding ratio (matching BOLT-LMM quality).</p>

        <h3>Key Metrics</h3>
        <div class="four-col">
            <div class="metric-box small">
                <div class="value">9.7%</div>
                <div class="label">LDSC Ratio</div>
            </div>
            <div class="metric-box small">
                <div class="value">862</div>
                <div class="label">Independent Loci</div>
            </div>
            <div class="metric-box small">
                <div class="value">187K</div>
                <div class="label">GWS Variants</div>
            </div>
            <div class="metric-box small">
                <div class="value">8 min</div>
                <div class="label">Total Time</div>
            </div>
        </div>

        <h3>Manhattan Plot</h3>
        <div class="manhattan-container">
            <canvas id="manhattan-canvas"></canvas>
            <div style="display: flex; justify-content: center; gap: 2rem; margin-top: 0.5rem; font-size: 0.75rem;">
                <span><span style="color: #ff6b00;">●</span> GWS (P &lt; 5×10⁻⁸)</span>
                <span><span style="color: #444;">●</span> Non-significant</span>
                <span style="color: #666;">— GWS threshold (-log₁₀P = 7.3)</span>
            </div>
        </div>

        <div class="two-col">
            <div>
                <h3>QQ Plot</h3>
                <div class="qq-container">
                    <canvas id="qq-canvas"></canvas>
                </div>
                <p style="font-size: 0.8rem; color: var(--text-muted);">
                    LDSC ratio = 9.7% confirms only ~10% is confounding<br>
                    (matches BOLT-LMM quality at 9.9% ratio).<br>
                    λ_GC = 2.18 reflects high polygenicity of height.
                </p>
            </div>
            <div>
                <h3>LDSC Validation</h3>
                <table style="font-size: 0.75rem;">
                    <tr><th>Metric</th><th>Value</th><th>Notes</th></tr>
                    <tr><td>h² (SNP heritability)</td><td class="highlight">0.55</td><td>Expected for height</td></tr>
                    <tr><td>Lambda GC</td><td>2.18</td><td>High polygenicity</td></tr>
                    <tr><td>Intercept</td><td>1.46</td><td>Baseline inflation</td></tr>
                    <tr><td>Ratio (confounding)</td><td class="highlight">9.7%</td><td>Matches BOLT-LMM</td></tr>
                    <tr><td>HapMap3 overlap</td><td>875K</td><td>Imputed GWAS</td></tr>
                </table>
            </div>
        </div>

        <h3>Pipeline Timing Breakdown</h3>
        <div class="diagram"><strong>COMPLETE GWAS PIPELINE (~8 minutes total)</strong>

Step 1+2: Per-chr SNP Selection (~3 min)
|-- Stream 1.06M array variants from cupgen
|-- Univariate screening + val-filter
+-- Per-chromosome LASSO -> ~40k candidates

Step 3: LOCO Model Training (~3 min)
|-- Joint LASSO on ~40k candidates
|-- ~25k active SNPs selected
+-- 22x LOCO OLS (closed-form refit)

Step 4: Association Testing (~2 min)
|-- 6,817,622 imputed variants tested
|-- Test against LOCO residuals
+-- Output: 862 independent loci

===================================================================
336K samples x 6.8M variants -> 862 loci in ~8 min on single H100
===================================================================</div>
    </div>
</section>

<!-- Scaling Section -->
<section class="slide" id="scaling">
    <div class="slide-content">
        <h2><span class="section-num">★</span>Scaling: Full Imputed GWAS Validated</h2>

        <p>Step 4 (GWAS) is <strong>embarrassingly parallel</strong> — each variant is independent. Successfully validated on <strong>6.8M imputed variants × 336K samples</strong>.</p>

        <h3>Current Performance (Validated on 336K samples)</h3>
        <table>
            <tr>
                <th>Metric</th>
                <th>Value</th>
                <th>Notes</th>
            </tr>
            <tr>
                <td>Imputed GWAS variants</td>
                <td class="highlight">6,817,622</td>
                <td>Full imputed panel</td>
            </tr>
            <tr>
                <td>Samples processed</td>
                <td class="highlight">336,442</td>
                <td>Full unified cohort</td>
            </tr>
            <tr>
                <td>Step 1-3 time</td>
                <td>~6 min</td>
                <td>LOCO model training</td>
            </tr>
            <tr>
                <td>Step 4 time</td>
                <td>~2 min</td>
                <td>6.8M variants tested</td>
            </tr>
        </table>

        <h3>Top Independent Loci by Chromosome</h3>
        <table>
            <tr>
                <th>Chr</th>
                <th>Loci</th>
                <th>Top Hit</th>
                <th>Top P-value</th>
            </tr>
            <tr>
                <td>2</td>
                <td class="highlight">77</td>
                <td>rs59985551</td>
                <td>1.5×10⁻²⁰⁶</td>
            </tr>
            <tr>
                <td>1</td>
                <td class="highlight">74</td>
                <td>rs11205303</td>
                <td>4.6×10⁻¹³²</td>
            </tr>
            <tr>
                <td>3</td>
                <td>58</td>
                <td>rs4683605</td>
                <td class="highlight">&lt;10⁻³⁰⁰</td>
            </tr>
            <tr>
                <td>20</td>
                <td>36</td>
                <td>rs143384</td>
                <td class="highlight">&lt;10⁻³⁰⁰</td>
            </tr>
            <tr>
                <td>6 (HLA)</td>
                <td>60</td>
                <td>rs59329931</td>
                <td>8.5×10⁻¹⁷¹</td>
            </tr>
        </table>
        <p><em>862 independent loci identified (±1Mb clumping). Top signals on chr3/chr20 exceed float64 precision.</em></p>

        <h3>Cloud-Burst Architecture</h3>
        <div class="diagram"><strong>MULTI-GPU SCALING STRATEGY</strong>

Each worker only needs:
|-- LOCO predictions: 336K x 22 x 4 bytes = <span style="color: var(--orange-primary);">30 MB</span> (broadcast once)
+-- Its genotype chunk: streamed from NVMe

Workflow:
+-----------------------------------------------------------+
|  1. Run Steps 1-3 on single H100 (~6 min)                 |
|  2. Broadcast 30 MB LOCO predictions to N workers         |
|  3. Scatter 6.8M imputed variants across workers          |
|  4. Run Step 4 in parallel (~2 min)                       |
|  5. Collect and merge results                             |
+-----------------------------------------------------------+

<span style="color: var(--orange-primary);">Full biobank-scale GWAS (336K x 6.8M) in ~8 minutes on single H100.</span></div>

        <h3>Comparison to Traditional Methods</h3>
        <table>
            <tr>
                <th>Method</th>
                <th>Runtime</th>
                <th>LOCO Model</th>
                <th>LDSC Ratio</th>
            </tr>
            <tr>
                <td>BOLT-LMM</td>
                <td>12-48 hours</td>
                <td>~1M SNPs (ridge)</td>
                <td>~10%</td>
            </tr>
            <tr>
                <td>SAIGE</td>
                <td>6-24 hours</td>
                <td>~1M SNPs (ridge)</td>
                <td>~10%</td>
            </tr>
            <tr>
                <td>regenie</td>
                <td>3-6 hours</td>
                <td>~1M SNPs (ridge)</td>
                <td>~10%</td>
            </tr>
            <tr class="highlight">
                <td><strong>UltraLasso</strong></td>
                <td><strong>8 min</strong></td>
                <td><strong>~25K SNPs (LASSO)</strong></td>
                <td><strong>9.7%</strong></td>
            </tr>
        </table>
        <p><em>LDSC ratio measures fraction of genomic inflation due to confounding (lower = better). UltraLasso matches BOLT-LMM quality with 40× fewer LOCO SNPs and 90-360× faster.</em></p>
    </div>
</section>

<!-- Multi-Phenotype Scaling Section -->
<section class="slide" id="multi-pheno">
    <div class="slide-content">
        <h2><span class="section-num">★</span>The Real Win: Multi-Phenotype Batching</h2>

        <blockquote>
            <strong>Key insight:</strong> I/O is the bottleneck, not compute. Reading genotypes costs the same whether you compute 1 phenotype or 100. Adding phenotypes is <em>nearly free</em>.
        </blockquote>

        <h3>Why Multi-Phenotype Scales Sublinearly</h3>
        <div class="two-col">
            <div>
                <h4>Single Phenotype Breakdown</h4>
                <div class="progress-item">
                    <div class="progress-label"><span>I/O (read cupgen)</span><span class="highlight">~60%</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 60%"></div></div>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>Compute (stats)</span><span>~35%</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 35%"></div></div>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>Overhead</span><span>~5%</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 5%"></div></div>
                </div>
            </div>
            <div>
                <h4>Batched: N Phenotypes</h4>
                <div class="progress-item">
                    <div class="progress-label"><span>I/O (read once)</span><span class="highlight">SAME</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 60%"></div></div>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>Compute × N</span><span>~1.5× for 100 phenos</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 50%"></div></div>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>Overhead</span><span>~5%</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 5%"></div></div>
                </div>
            </div>
        </div>

        <h3>Multi-Phenotype Architecture (8 GPUs x 8 Phenotypes)</h3>
        <div class="diagram"><strong>BATCHED MULTI-PHENOTYPE GWAS</strong>

<span style="color: var(--orange-primary);">Step 1+2+4: I/O-bound -> Batch phenotypes per GPU chunk</span>
+----------------------------------------------------------------+
|  GPU 0: Genome chunk 1/8 -> Compute stats for ALL 8 phenotypes |
|  GPU 1: Genome chunk 2/8 -> Compute stats for ALL 8 phenotypes |
|  ...                                                           |
|  GPU 7: Genome chunk 8/8 -> Compute stats for ALL 8 phenotypes |
+----------------------------------------------------------------+
                   v One cupgen read serves 8 phenotypes!

<span style="color: var(--orange-primary);">Step 3: Compute-bound -> Distribute phenotypes across GPUs</span>
+----------------------------------------------------------------+
|  GPU 0-2: Phenotypes 1-3 (FISTA + LOCO)                        |
|  GPU 3-5: Phenotypes 4-6 (FISTA + LOCO)                        |
|  GPU 6-7: Phenotypes 7-8 (FISTA + LOCO)                        |
+----------------------------------------------------------------+
                   v Each phenotype needs its own LOCO model

<span style="color: var(--orange-primary);">Result: 8 complete GWAS in ~12 minutes (vs 8 x 8 = 64 min naive)</span></div>

        <h3>Scaling Efficiency</h3>
        <table>
            <tr>
                <th>Phenotypes</th>
                <th>Naive Time</th>
                <th>Batched Time</th>
                <th>Efficiency</th>
            </tr>
            <tr>
                <td>1</td>
                <td>8 min</td>
                <td>8 min</td>
                <td>1×</td>
            </tr>
            <tr>
                <td>8 (on 8 GPUs)</td>
                <td>64 min</td>
                <td class="highlight">~12 min</td>
                <td class="highlight">5×</td>
            </tr>
            <tr>
                <td>100 (on 8 GPUs)</td>
                <td>13 hours</td>
                <td class="highlight">~30 min</td>
                <td class="highlight">26×</td>
            </tr>
            <tr>
                <td>1000 (on 8 GPUs)</td>
                <td>~6 days</td>
                <td class="highlight">~3 hours</td>
                <td class="highlight">48×</td>
            </tr>
            <tr>
                <td>3000 (FinnGen-scale)</td>
                <td>~17 days</td>
                <td class="highlight">~6-8 hours</td>
                <td class="highlight">50-70×</td>
            </tr>
        </table>

        <h3>Why This Matters</h3>
        <div class="three-col">
            <div class="metric-box">
                <div class="value" style="font-size: 1.3rem;">PheWAS</div>
                <div class="label">3000 phenotypes in hours</div>
            </div>
            <div class="metric-box">
                <div class="value" style="font-size: 1.3rem;">Sensitivity</div>
                <div class="label">Run 10 covariate models free</div>
            </div>
            <div class="metric-box">
                <div class="value" style="font-size: 1.3rem;">Interactive</div>
                <div class="label">Same-day iteration</div>
            </div>
        </div>

        <p style="margin-top: 2rem;"><strong>Bottom line:</strong> A single GWAS in 8 minutes is impressive. But 3000 phenotypes in 6-8 hours — that's <em>transformative</em>. It makes rigorous genetic epidemiology (sensitivity analyses, stratification, conditional GWAS) computationally feasible for the first time.</p>
    </div>
</section>

<!-- Pipeline Overview -->
<section class="slide" id="pipeline">
    <div class="slide-content">
        <h2><span class="section-num">0</span>Pipeline Overview</h2>

        <p>UltraLasso transforms raw genotype data into polygenic risk scores and GWAS results through a GPU-accelerated pipeline:</p>

        <div class="pipeline">
            <div class="pipeline-stage">
                <div class="pipeline-label">Input</div>
                <div class="pipeline-content">
                    <div class="pipeline-box">
                        <div class="box-title">PGEN Files</div>
                        <div class="box-value">~150 GB</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box highlight-box">
                        <div class="box-title">Convert to</div>
                        <div class="box-value">.cupgen</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box">
                        <div class="box-title">GPU-Native</div>
                        <div class="box-value">~62 GB</div>
                    </div>
                </div>
            </div>

            <div class="pipeline-stage">
                <div class="pipeline-label">Step 1+2<br><small>Per Chr</small></div>
                <div class="pipeline-content">
                    <div class="pipeline-box">
                        <div class="box-title">Stream</div>
                        <div class="box-value">1.06M SNPs</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box">
                        <div class="box-title">Val-filter</div>
                        <div class="box-value">Screen + LOO</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box highlight-box">
                        <div class="box-title">LASSO</div>
                        <div class="box-value">~40K kept</div>
                    </div>
                </div>
            </div>

            <div class="pipeline-stage">
                <div class="pipeline-label">Step 3<br><small>LOCO</small></div>
                <div class="pipeline-content">
                    <div class="pipeline-box">
                        <div class="box-title">Joint FISTA</div>
                        <div class="box-value">40K → 25K</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box highlight-box">
                        <div class="box-title">22× LOCO OLS</div>
                        <div class="box-value">~25K active</div>
                    </div>
                </div>
            </div>

            <div class="pipeline-stage">
                <div class="pipeline-label">Step 4<br><small>GWAS</small></div>
                <div class="pipeline-content">
                    <div class="pipeline-box">
                        <div class="box-title">Residualize</div>
                        <div class="box-value">y - ŷ_LOCO</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box">
                        <div class="box-title">Test</div>
                        <div class="box-value">6.8M var</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box highlight-box">
                        <div class="box-title">Output</div>
                        <div class="box-value">862 loci</div>
                    </div>
                </div>
            </div>
        </div>

        <h3>Key Innovations</h3>
        <div class="three-col">
            <div class="metric-box">
                <div class="value" style="font-size: 1.5rem;">.cupgen</div>
                <div class="label">GPU-native genotype format</div>
            </div>
            <div class="metric-box">
                <div class="value" style="font-size: 1.2rem;">Univariate-guided</div>
                <div class="label">Sparse SNP selection</div>
            </div>
            <div class="metric-box">
                <div class="value" style="font-size: 1.3rem;">Fast OLS LOCO</div>
                <div class="label">Closed-form 22× refit</div>
            </div>
        </div>
    </div>
</section>

<!-- Results Section -->
<section class="slide" id="results">
    <div class="slide-content">
        <h2><span class="section-num">10</span>Performance Summary</h2>

        <h3>GWAS Performance (Height, 336K samples)</h3>
        <table>
            <tr>
                <th>Method</th>
                <th>LOCO SNPs</th>
                <th>Lambda GC</th>
                <th>LDSC Ratio</th>
                <th>Runtime</th>
            </tr>
            <tr>
                <td>regenie (ridge)</td>
                <td>~500K-1M</td>
                <td>~2.0</td>
                <td>~10%</td>
                <td>3-6 hours</td>
            </tr>
            <tr>
                <td>BOLT-LMM</td>
                <td>all (~1M)</td>
                <td>~2.0</td>
                <td>9.9%</td>
                <td>12-48 hours</td>
            </tr>
            <tr class="highlight">
                <td><strong>GPU UltraLasso</strong></td>
                <td><strong>~25K</strong></td>
                <td><strong>2.18</strong></td>
                <td><strong>9.7%</strong></td>
                <td><strong>8 min</strong></td>
            </tr>
        </table>

        <blockquote>
            <strong>Key finding:</strong> GPU UltraLasso achieves equivalent LDSC quality to BOLT-LMM with only <strong>~25K LOCO SNPs</strong> while being <strong>90-360× faster</strong>. LDSC ratio 9.7% confirms ~90% of genomic inflation is true signal.
        </blockquote>

        <h3>Throughput Metrics</h3>
        <div class="two-col">
            <div>
                <table>
                    <tr><th>Metric</th><th>Value</th></tr>
                    <tr><td>Imputed variants tested</td><td class="highlight">6,817,622</td></tr>
                    <tr><td>Samples</td><td class="highlight">336,442</td></tr>
                    <tr><td>Genotype calls</td><td class="highlight">2.3 trillion</td></tr>
                    <tr><td>Independent loci</td><td class="highlight">862</td></tr>
                </table>
            </div>
            <div>
                <div class="metric-box" style="margin-top: 0;">
                    <div class="value">90-360×</div>
                    <div class="label">Speedup vs Traditional</div>
                </div>
            </div>
        </div>

        <h3>Why Sparse LOCO Works</h3>
        <p>The LOCO prediction captures polygenic background, population structure, and cryptic relatedness. LDSC validation confirms that <strong>~90% of genomic inflation is true polygenic signal</strong>, not confounding.</p>

        <ul>
            <li><strong>Phenotype-guided selection:</strong> ~25K SNPs capture more variance than ~1M random SNPs</li>
            <li><strong>SE-weighted strength:</strong> Implicit shrinkage prevents winner's curse</li>
            <li><strong>LDSC validated:</strong> 9.7% confounding ratio matches BOLT-LMM (9.9%)</li>
        </ul>
    </div>
</section>

<!-- Appendix -->
<section class="slide">
    <div class="slide-content">
        <h2><span class="section-num">A</span>Technical Details & References</h2>

        <h3>LOCO GWAS Pipeline</h3>
        <p>Leave-one-chromosome-out (LOCO) predictions enable unbiased GWAS without mixed models.</p>

        <pre><code>Step 1+2: Per-chr SNP selection with val-filter
          → 1.06M variants → ~40K candidates
          → SE-weighted strength formula prevents winner's curse

Step 3: Joint LASSO + 22× LOCO OLS
          → ~25K active SNPs → 22 LOCO predictions
          → OLS refit is closed-form (no iterations)

Step 4: Test 6.8M imputed variants
          → Residualize y - ŷ_LOCO[chr_i] for each variant
          → Output: 862 independent loci (±1Mb clumping)</code></pre>

        <h3>LDSC Validation</h3>
        <p>LD Score regression confirms GWAS quality matches BOLT-LMM.</p>

        <pre><code>Metric          Our GWAS    BOLT-LMM (LDL reference)
─────────────────────────────────────────────────────
h² (SNP)        0.55        0.19 (different trait)
Lambda GC       2.13        1.47 (different trait)
Ratio           9.7%        9.9%    ← KEY METRIC!
─────────────────────────────────────────────────────
Interpretation: ~90% of inflation is true signal,
                only ~10% is confounding</code></pre>

        <h3>Glossary</h3>
        <div class="glossary-grid">
            <span class="glossary-term">LOCO</span>
            <span class="glossary-def">Leave-One-Chromosome-Out (prevents proximal contamination)</span>

            <span class="glossary-term">λ_GC</span>
            <span class="glossary-def">Genomic inflation factor (should be ~1.0 for well-calibrated GWAS)</span>

            <span class="glossary-term">GWS</span>
            <span class="glossary-def">Genome-wide significant (P < 5×10⁻⁸)</span>

            <span class="glossary-term">FISTA</span>
            <span class="glossary-def">Fast Iterative Shrinkage-Thresholding Algorithm</span>

            <span class="glossary-term">.cupgen</span>
            <span class="glossary-def">CUDA-optimized Packed GENotypes format</span>
        </div>

        <h3>References</h3>
        <ol style="font-size: 0.85rem; color: var(--text-muted);">
            <li>Mbatchou, J. et al. (2021). Computationally efficient whole-genome regression. Nature Genetics.</li>
            <li>Chatterjee, S., Hastie, T., & Tibshirani, R. (2025). Univariate-guided sparse regression. HDSR.</li>
            <li>Loh, P.-R. et al. (2015). Efficient Bayesian mixed-model analysis. Nature Genetics.</li>
        </ol>
    </div>
</section>

<footer>
    <div class="logo pulse">ULTRALASSO</div>
    <p>
        <span style="color: var(--orange-primary);">U</span>ltra-fast
        <span style="color: var(--orange-primary);">L</span>arge-scale
        <span style="color: var(--orange-primary);">T</span>ensor-accelerated
        <span style="color: var(--orange-primary);">R</span>egression
        <span style="color: var(--orange-primary);">A</span>rchitecture based on
        <span style="color: var(--orange-primary);">LASSO</span>
    </p>
    <p style="margin-top: 1rem;">Report: January 2026 · Version 3.0 · 336K samples · 6.8M variants · 862 loci · LDSC validated</p>
</footer>

<script>
// GWAS visualization data (binned for efficient rendering)
const GWAS_DATA={"bins": [[0, 1, 226, 1], [1, 1, 342, 1], [2, 1, 865, 1], [3, 1, 263, 1], [4, 1, 305, 1], [5, 1, 323, 1], [6, 1, 311, 1], [7, 1, 699, 1], [8, 1, 408, 1], [9, 1, 202, 1], [10, 1, 66, 0], [11, 1, 166, 1], [12, 1, 154, 1], [13, 1, 312, 1], [14, 1, 183, 1], [15, 1, 462, 1], [16, 1, 236, 1], [17, 1, 372, 1], [18, 1, 64, 0], [19, 1, 175, 1], [20, 1, 837, 1], [22, 1, 19, 0], [24, 1, 12, 0], [25, 1, 1313, 1], [26, 1, 284, 1], [27, 1, 90, 1], [28, 1, 70, 0], [29, 1, 785, 1], [30, 1, 478, 1], [31, 1, 962, 1], [32, 1, 63, 0], [33, 1, 56, 0], [34, 1, 127, 1], [35, 1, 267, 1], [36, 1, 148, 1], [37, 1, 651, 1], [38, 1, 244, 1], [39, 1, 735, 1], [40, 1, 131, 1], [41, 1, 59, 0], [42, 1, 174, 1], [43, 2, 156, 1], [44, 2, 328, 1], [45, 2, 107, 1], [46, 2, 372, 1], [47, 2, 841, 1], [48, 2, 466, 1], [49, 2, 409, 1], [50, 2, 276, 1], [51, 2, 353, 1], [52, 2, 2058, 1], [53, 2, 126, 1], [54, 2, 129, 1], [55, 2, 553, 1], [56, 2, 77, 1], [57, 2, 46, 0], [58, 2, 427, 1], [59, 2, 241, 1], [60, 2, 307, 1], [61, 2, 158, 1], [62, 2, 94, 1], [63, 2, 85, 1], [64, 2, 343, 1], [65, 2, 141, 1], [66, 2, 130, 1], [67, 2, 54, 0], [68, 2, 73, 1], [69, 2, 72, 0], [70, 2, 118, 1], [71, 2, 108, 1], [72, 2, 352, 1], [73, 2, 262, 1], [74, 2, 290, 1], [75, 2, 102, 1], [76, 2, 128, 1], [77, 2, 170, 1], [78, 2, 143, 1], [79, 2, 78, 1], [80, 2, 150, 1], [81, 2, 452, 1], [82, 2, 387, 1], [83, 2, 728, 1], [84, 2, 137, 1], [85, 2, 272, 1], [86, 3, 232, 1], [87, 3, 310, 1], [88, 3, 72, 0], [89, 3, 127, 1], [90, 3, 117, 1], [91, 3, 228, 1], [92, 3, 235, 1], [93, 3, 286, 1], [94, 3, 549, 1], [95, 3, 369, 1], [96, 3, 313, 1], [97, 3, 445, 1], [98, 3, 57, 0], [99, 3, 116, 1], [100, 3, 107, 1], [101, 3, 45, 0], [102, 3, 231, 1], [103, 3, 66, 0], [104, 3, 140, 1], [105, 3, 173, 1], [106, 3, 110, 1], [107, 3, 620, 1], [108, 3, 417, 1], [109, 3, 3000, 1], [110, 3, 204, 1], [111, 3, 104, 1], [112, 3, 316, 1], [113, 3, 48, 0], [114, 3, 163, 1], [115, 3, 636, 1], [116, 3, 59, 0], [117, 3, 496, 1], [118, 3, 134, 1], [119, 4, 247, 1], [120, 4, 309, 1], [121, 4, 275, 1], [122, 4, 1816, 1], [123, 4, 59, 0], [124, 4, 167, 1], [125, 4, 50, 0], [126, 4, 206, 1], [127, 4, 97, 1], [128, 4, 203, 1], [129, 4, 398, 1], [130, 4, 38, 0], [131, 4, 55, 0], [132, 4, 556, 1], [133, 4, 150, 1], [134, 4, 1000, 1], [135, 4, 314, 1], [136, 4, 58, 0], [137, 4, 170, 1], [138, 4, 484, 1], [139, 4, 132, 1], [140, 4, 135, 1], [141, 4, 252, 1], [142, 4, 73, 1], [143, 4, 77, 1], [144, 4, 754, 1], [145, 4, 2346, 1], [146, 4, 117, 1], [147, 4, 85, 1], [148, 4, 45, 0], [149, 4, 54, 0], [150, 4, 47, 0], [151, 4, 264, 1], [152, 5, 160, 1], [153, 5, 52, 0], [154, 5, 133, 1], [155, 5, 67, 0], [156, 5, 38, 0], [157, 5, 33, 0], [158, 5, 774, 1], [159, 5, 304, 1], [160, 5, 386, 1], [161, 5, 113, 1], [162, 5, 591, 1], [163, 5, 110, 1], [164, 5, 195, 1], [165, 5, 231, 1], [166, 5, 267, 1], [167, 5, 97, 1], [168, 5, 473, 1], [169, 5, 182, 1], [170, 5, 155, 1], [171, 5, 328, 1], [172, 5, 343, 1], [173, 5, 96, 1], [174, 5, 394, 1], [175, 5, 760, 1], [176, 5, 524, 1], [177, 5, 186, 1], [178, 5, 93, 1], [179, 5, 84, 1], [180, 5, 124, 1], [181, 5, 87, 1], [182, 5, 868, 1], [183, 5, 1054, 1], [184, 5, 389, 1], [185, 6, 949, 1], [186, 6, 64, 0], [187, 6, 1605, 1], [188, 6, 1543, 1], [189, 6, 805, 1], [190, 6, 1700, 1], [191, 6, 373, 1], [192, 6, 295, 1], [193, 6, 95, 1], [194, 6, 96, 1], [195, 6, 58, 0], [196, 6, 116, 1], [197, 6, 468, 1], [198, 6, 570, 1], [199, 6, 155, 1], [200, 6, 42, 0], [201, 6, 75, 1], [202, 6, 1141, 1], [203, 6, 338, 1], [204, 6, 348, 1], [205, 6, 77, 1], [206, 6, 1157, 1], [207, 6, 397, 1], [208, 6, 159, 1], [209, 6, 1491, 1], [210, 6, 579, 1], [211, 6, 216, 1], [212, 6, 239, 1], [213, 6, 419, 1], [214, 7, 1543, 1], [215, 7, 297, 1], [216, 7, 75, 1], [217, 7, 409, 1], [218, 7, 1091, 1], [219, 7, 345, 1], [220, 7, 280, 1], [221, 7, 102, 1], [222, 7, 369, 1], [223, 7, 85, 1], [224, 7, 23, 0], [225, 7, 155, 1], [226, 7, 174, 1], [227, 7, 96, 1], [228, 7, 129, 1], [229, 7, 159, 1], [230, 7, 1637, 1], [231, 7, 211, 1], [232, 7, 89, 1], [233, 7, 80, 1], [234, 7, 141, 1], [235, 7, 157, 1], [236, 7, 142, 1], [237, 7, 252, 1], [238, 7, 130, 1], [239, 7, 633, 1], [240, 7, 352, 1], [241, 7, 84, 1], [242, 8, 91, 1], [243, 8, 143, 1], [244, 8, 59, 0], [245, 8, 419, 1], [246, 8, 306, 1], [247, 8, 54, 0], [248, 8, 113, 1], [249, 8, 44, 0], [250, 8, 277, 1], [251, 8, 1023, 1], [252, 8, 150, 1], [253, 8, 83, 1], [254, 8, 303, 1], [255, 8, 679, 1], [256, 8, 68, 0], [257, 8, 90, 1], [258, 8, 108, 1], [259, 8, 71, 0], [260, 8, 88, 1], [261, 8, 220, 1], [262, 8, 317, 1], [263, 8, 229, 1], [264, 8, 917, 1], [265, 8, 646, 1], [266, 8, 369, 1], [267, 9, 161, 1], [268, 9, 93, 1], [269, 9, 136, 1], [270, 9, 176, 1], [271, 9, 71, 0], [272, 9, 72, 0], [273, 9, 131, 1], [274, 9, 33, 0], [275, 9, 6, 0], [276, 9, 17, 0], [277, 9, 11, 0], [278, 9, 15, 0], [279, 9, 48, 0], [280, 9, 714, 1], [281, 9, 155, 1], [282, 9, 418, 1], [283, 9, 429, 1], [284, 9, 908, 1], [285, 9, 343, 1], [286, 9, 509, 1], [287, 9, 673, 1], [288, 9, 203, 1], [289, 9, 143, 1], [290, 9, 589, 1], [291, 9, 440, 1], [292, 10, 342, 1], [293, 10, 578, 1], [294, 10, 72, 0], [295, 10, 156, 1], [296, 10, 208, 1], [297, 10, 107, 1], [298, 10, 39, 0], [299, 10, 113, 1], [300, 10, 181, 1], [301, 10, 50, 0], [302, 10, 261, 1], [303, 10, 382, 1], [304, 10, 91, 1], [305, 10, 526, 1], [306, 10, 117, 1], [307, 10, 313, 1], [308, 10, 235, 1], [309, 10, 516, 1], [310, 10, 49, 0], [311, 10, 91, 1], [312, 10, 329, 1], [313, 10, 332, 1], [314, 10, 94, 1], [315, 11, 545, 1], [316, 11, 120, 1], [317, 11, 259, 1], [318, 11, 231, 1], [319, 11, 76, 1], [320, 11, 182, 1], [321, 11, 93, 1], [322, 11, 99, 1], [323, 11, 484, 1], [324, 11, 132, 1], [325, 11, 149, 1], [326, 11, 1839, 1], [327, 11, 211, 1], [328, 11, 722, 1], [329, 11, 89, 1], [330, 11, 95, 1], [331, 11, 86, 1], [332, 11, 56, 0], [333, 11, 42, 0], [334, 11, 62, 0], [335, 11, 168, 1], [336, 11, 188, 1], [337, 11, 164, 1], [338, 12, 412, 1], [339, 12, 205, 1], [340, 12, 473, 1], [341, 12, 175, 1], [342, 12, 262, 1], [343, 12, 781, 1], [344, 12, 123, 1], [345, 12, 157, 1], [346, 12, 244, 1], [347, 12, 176, 1], [348, 12, 237, 1], [349, 12, 234, 1], [350, 12, 1893, 1], [351, 12, 46, 0], [352, 12, 181, 1], [353, 12, 53, 0], [354, 12, 1114, 1], [355, 12, 105, 1], [356, 12, 409, 1], [357, 12, 192, 1], [358, 12, 193, 1], [359, 12, 284, 1], [360, 12, 480, 1], [361, 12, 85, 1], [365, 13, 216, 1], [366, 13, 111, 1], [367, 13, 172, 1], [368, 13, 161, 1], [369, 13, 122, 1], [370, 13, 1308, 1], [371, 13, 71, 0], [372, 13, 32, 0], [373, 13, 53, 0], [374, 13, 116, 1], [375, 13, 144, 1], [376, 13, 139, 1], [377, 13, 387, 1], [378, 13, 71, 0], [379, 13, 171, 1], [380, 13, 56, 0], [381, 13, 277, 1], [385, 14, 317, 1], [386, 14, 359, 1], [387, 14, 110, 1], [388, 14, 155, 1], [389, 14, 70, 0], [390, 14, 77, 1], [391, 14, 172, 1], [392, 14, 898, 1], [393, 14, 899, 1], [394, 14, 492, 1], [395, 14, 172, 1], [396, 14, 41, 0], [397, 14, 577, 1], [398, 14, 884, 1], [399, 14, 443, 1], [400, 14, 136, 1], [403, 15, 13, 0], [404, 15, 102, 1], [405, 15, 59, 0], [406, 15, 57, 0], [407, 15, 254, 1], [408, 15, 276, 1], [409, 15, 306, 1], [410, 15, 110, 1], [411, 15, 214, 1], [412, 15, 912, 1], [413, 15, 610, 1], [414, 15, 135, 1], [415, 15, 1518, 1], [416, 15, 170, 1], [417, 15, 1728, 1], [418, 16, 577, 1], [419, 16, 216, 1], [420, 16, 300, 1], [421, 16, 102, 1], [422, 16, 146, 1], [423, 16, 270, 1], [424, 16, 25, 0], [425, 16, 2, 0], [426, 16, 159, 1], [427, 16, 378, 1], [428, 16, 83, 1], [429, 16, 238, 1], [430, 16, 384, 1], [431, 16, 171, 1], [432, 16, 237, 1], [433, 16, 384, 1], [434, 17, 177, 1], [435, 17, 672, 1], [436, 17, 165, 1], [437, 17, 279, 1], [438, 17, 1556, 1], [439, 17, 230, 1], [440, 17, 348, 1], [441, 17, 425, 1], [442, 17, 554, 1], [443, 17, 496, 1], [444, 17, 1100, 1], [445, 17, 272, 1], [446, 17, 222, 1], [447, 17, 208, 1], [448, 18, 99, 1], [449, 18, 63, 0], [450, 18, 146, 1], [451, 18, 2006, 1], [452, 18, 98, 1], [453, 18, 186, 1], [454, 18, 42, 0], [455, 18, 104, 1], [456, 18, 630, 1], [457, 18, 150, 1], [458, 18, 323, 1], [459, 18, 49, 0], [460, 18, 68, 0], [461, 19, 689, 1], [462, 19, 450, 1], [463, 19, 480, 1], [464, 19, 287, 1], [465, 19, 54, 0], [466, 19, 99, 1], [467, 19, 113, 1], [468, 19, 423, 1], [469, 19, 219, 1], [470, 19, 254, 1], [471, 19, 413, 1], [472, 20, 1201, 1], [473, 20, 140, 1], [474, 20, 145, 1], [475, 20, 156, 1], [476, 20, 81, 1], [477, 20, 3000, 1], [478, 20, 269, 1], [479, 20, 168, 1], [480, 20, 574, 1], [481, 20, 185, 1], [482, 20, 154, 1], [484, 21, 18, 0], [485, 21, 85, 1], [486, 21, 40, 0], [487, 21, 113, 1], [488, 21, 272, 1], [489, 21, 335, 1], [490, 21, 200, 1], [491, 21, 209, 1], [493, 22, 19, 0], [494, 22, 302, 1], [495, 22, 88, 1], [496, 22, 211, 1], [497, 22, 195, 1], [498, 22, 224, 1], [499, 22, 248, 1]], "chr_mids": {"1": 0.043, "2": 0.129, "3": 0.205, "4": 0.273, "5": 0.337, "6": 0.398, "7": 0.456, "8": 0.509, "9": 0.559, "10": 0.607, "11": 0.654, "12": 0.7, "13": 0.744, "14": 0.782, "15": 0.819, "16": 0.852, "17": 0.882, "18": 0.91, "19": 0.933, "20": 0.955, "21": 0.974, "22": 0.991}, "gws_thresh": 73, "n_bins": 500};

// QQ data (sampled)
const QQ_DATA = {
    e: [6.83, 4.57, 4.27, 4.09, 3.97, 3.87, 3.79, 3.72, 3.67, 3.61, 3.57, 3.53, 3.49, 3.45, 3.42, 3.39, 3.36, 3.34, 3.31, 3.29, 3.27, 3.25, 3.23, 3.21, 3.19, 3.17, 3.15, 3.14, 3.12, 3.11, 3.09, 3.08, 3.06, 3.05, 3.04, 3.02, 3.01, 3.0, 1.83, 1.54, 1.37, 1.25, 1.15, 1.07, 1.01, 0.95, 0.9, 0.85, 0.81, 0.78, 0.74, 0.71, 0.68, 0.65, 0.63, 0.6, 0.58, 0.56, 0.53, 0.51, 0.49, 0.48, 0.46, 0.44, 0.43, 0.41, 0.39, 0.38, 0.37, 0.35, 0.34, 0.33, 0.31, 0.3, 0.29, 0.28, 0.27, 0.25, 0.24, 0.23, 0.22, 0.21, 0.2, 0.19, 0.19, 0.18, 0.17, 0.16, 0.15, 0.14, 0.13, 0.12, 0.12, 0.11, 0.1, 0.09, 0.09, 0.08, 0.07, 0.06, 0.06, 0.05, 0.04, 0.04, 0.03, 0.02, 0.02, 0.01, 0.01, 0.0],
    o: [300.0, 185.1, 168.4, 152.2, 144.7, 128.5, 119.0, 112.1, 110.2, 106.3, 99.6, 96.7, 90.1, 85.5, 81.7, 78.5, 76.6, 75.0, 73.6, 72.9, 71.6, 69.5, 68.0, 66.9, 66.0, 65.1, 63.8, 62.9, 62.0, 60.9, 59.6, 58.8, 57.8, 57.7, 57.3, 56.8, 56.1, 55.4, 11.2, 7.0, 5.1, 4.1, 3.4, 3.0, 2.6, 2.3, 2.1, 2.0, 1.8, 1.7, 1.6, 1.5, 1.4, 1.3, 1.2, 1.2, 1.1, 1.0, 1.0, 0.9, 0.9, 0.9, 0.8, 0.8, 0.7, 0.7, 0.7, 0.7, 0.6, 0.6, 0.6, 0.5, 0.5, 0.5, 0.5, 0.5, 0.4, 0.4, 0.4, 0.4, 0.4, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
};

// Draw Manhattan plot
function drawManhattan() {
    const canvas = document.getElementById('manhattan-canvas');
    const ctx = canvas.getContext('2d');

    // Set canvas size with device pixel ratio for sharp rendering
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);

    const width = rect.width;
    const height = rect.height;
    const padding = {top: 20, right: 20, bottom: 40, left: 50};
    const plotWidth = width - padding.left - padding.right;
    const plotHeight = height - padding.top - padding.bottom;

    // Clear
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, width, height);

    // Find max Y (cap at 300 for display - height has very strong signals)
    const maxY = 300;
    const gwsThresh = GWAS_DATA.gws_thresh / 10; // Convert back from stored format

    // Draw grid lines
    ctx.strokeStyle = '#222';
    ctx.lineWidth = 1;
    for (let y = 0; y <= maxY; y += 50) {
        const yPos = padding.top + plotHeight - (y / maxY * plotHeight);
        ctx.beginPath();
        ctx.moveTo(padding.left, yPos);
        ctx.lineTo(width - padding.right, yPos);
        ctx.stroke();
    }

    // Draw GWS threshold line
    const threshY = padding.top + plotHeight - (gwsThresh / maxY * plotHeight);
    ctx.strokeStyle = '#444';
    ctx.setLineDash([5, 5]);
    ctx.beginPath();
    ctx.moveTo(padding.left, threshY);
    ctx.lineTo(width - padding.right, threshY);
    ctx.stroke();
    ctx.setLineDash([]);

    // Draw points
    const nBins = GWAS_DATA.n_bins;
    GWAS_DATA.bins.forEach(bin => {
        const [binIdx, chr, pVal10, isGws] = bin;
        const x = padding.left + (binIdx / nBins) * plotWidth;
        const y = Math.min(pVal10 / 10, maxY); // Convert back and cap
        const yPos = padding.top + plotHeight - (y / maxY * plotHeight);

        // Color: orange for GWS, alternating grays for chromosomes
        if (isGws) {
            ctx.fillStyle = '#ff6b00';
        } else {
            ctx.fillStyle = chr % 2 === 0 ? '#333' : '#555';
        }

        // Draw bar instead of point for bin visualization
        const barWidth = Math.max(2, plotWidth / nBins * 0.8);
        ctx.fillRect(x - barWidth/2, yPos, barWidth, plotHeight - (yPos - padding.top));
    });

    // Draw axes
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(padding.left, padding.top);
    ctx.lineTo(padding.left, height - padding.bottom);
    ctx.lineTo(width - padding.right, height - padding.bottom);
    ctx.stroke();

    // Y-axis labels
    ctx.fillStyle = '#888';
    ctx.font = '10px JetBrains Mono';
    ctx.textAlign = 'right';
    for (let y = 0; y <= maxY; y += 50) {
        const yPos = padding.top + plotHeight - (y / maxY * plotHeight);
        ctx.fillText(y.toString(), padding.left - 5, yPos + 3);
    }
    ctx.save();
    ctx.translate(15, height/2);
    ctx.rotate(-Math.PI/2);
    ctx.textAlign = 'center';
    ctx.fillText('-log₁₀(P)', 0, 0);
    ctx.restore();

    // Chromosome labels
    ctx.textAlign = 'center';
    Object.entries(GWAS_DATA.chr_mids).forEach(([chr, pos]) => {
        const x = padding.left + pos * plotWidth;
        if (parseInt(chr) % 2 === 1 || parseInt(chr) > 18) {
            ctx.fillText(chr, x, height - padding.bottom + 15);
        }
    });
    ctx.fillText('Chromosome', width/2, height - 5);
}

// Draw QQ plot
function drawQQ() {
    const canvas = document.getElementById('qq-canvas');
    const ctx = canvas.getContext('2d');

    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);

    const width = rect.width;
    const height = rect.height;
    const padding = {top: 20, right: 20, bottom: 40, left: 50};
    const plotWidth = width - padding.left - padding.right;
    const plotHeight = height - padding.top - padding.bottom;

    // Clear
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, width, height);

    // Max values (cap for display)
    const maxVal = 10;

    // Draw grid
    ctx.strokeStyle = '#222';
    ctx.lineWidth = 1;
    for (let v = 0; v <= maxVal; v += 2) {
        const pos = v / maxVal;
        // Horizontal
        ctx.beginPath();
        ctx.moveTo(padding.left, padding.top + plotHeight * (1 - pos));
        ctx.lineTo(width - padding.right, padding.top + plotHeight * (1 - pos));
        ctx.stroke();
        // Vertical
        ctx.beginPath();
        ctx.moveTo(padding.left + plotWidth * pos, padding.top);
        ctx.lineTo(padding.left + plotWidth * pos, height - padding.bottom);
        ctx.stroke();
    }

    // Draw diagonal (expected line)
    ctx.strokeStyle = '#666';
    ctx.setLineDash([3, 3]);
    ctx.beginPath();
    ctx.moveTo(padding.left, height - padding.bottom);
    ctx.lineTo(width - padding.right, padding.top);
    ctx.stroke();
    ctx.setLineDash([]);

    // Draw QQ points
    ctx.fillStyle = '#ff6b00';
    for (let i = 0; i < QQ_DATA.e.length; i++) {
        const e = Math.min(QQ_DATA.e[i], maxVal);
        const o = Math.min(QQ_DATA.o[i], maxVal);
        const x = padding.left + (e / maxVal) * plotWidth;
        const y = padding.top + plotHeight - (o / maxVal) * plotHeight;

        ctx.beginPath();
        ctx.arc(x, y, 2, 0, Math.PI * 2);
        ctx.fill();
    }

    // Axes
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(padding.left, padding.top);
    ctx.lineTo(padding.left, height - padding.bottom);
    ctx.lineTo(width - padding.right, height - padding.bottom);
    ctx.stroke();

    // Labels
    ctx.fillStyle = '#888';
    ctx.font = '10px JetBrains Mono';
    ctx.textAlign = 'right';
    for (let v = 0; v <= maxVal; v += 2) {
        const yPos = padding.top + plotHeight * (1 - v/maxVal);
        ctx.fillText(v.toString(), padding.left - 5, yPos + 3);
    }
    ctx.textAlign = 'center';
    for (let v = 0; v <= maxVal; v += 2) {
        const xPos = padding.left + (v/maxVal) * plotWidth;
        ctx.fillText(v.toString(), xPos, height - padding.bottom + 15);
    }

    ctx.fillText('Expected -log₁₀(P)', width/2, height - 5);
    ctx.save();
    ctx.translate(12, height/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillText('Observed -log₁₀(P)', 0, 0);
    ctx.restore();

    // Lambda annotation
    ctx.fillStyle = '#ff6b00';
    ctx.font = '11px JetBrains Mono';
    ctx.textAlign = 'left';
    ctx.fillText('LDSC ratio = 9.7% | λ_GC = 2.18', padding.left + 10, padding.top + 20);
}

// Initialize on load
window.addEventListener('load', () => {
    drawManhattan();
    drawQQ();
});

// Redraw on resize
window.addEventListener('resize', () => {
    drawManhattan();
    drawQQ();
});
</script>

</body>
</html>
