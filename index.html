<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraLasso | GPU-Accelerated Genome-Wide Sparse Regression</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #111111;
            --bg-card: #0d0d0d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #666666;
            --orange-primary: #ff6b00;
            --orange-secondary: #ff8c38;
            --orange-dim: #cc5500;
            --orange-glow: rgba(255, 107, 0, 0.15);
            --border-color: #1a1a1a;
            --border-highlight: #2a2a2a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            font-size: 14px;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(180deg, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.8) 80%, transparent 100%);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            color: var(--orange-primary);
            font-weight: 700;
            font-size: 1.2rem;
            letter-spacing: 2px;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.75rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--orange-primary);
        }

        /* Slide sections */
        .slide {
            min-height: 100vh;
            padding: 8rem 4rem 4rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            border-bottom: 1px solid var(--border-color);
        }

        .slide::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--orange-dim), transparent);
            opacity: 0.3;
        }

        .slide-content {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Title slide - CENTERED */
        .title-slide {
            text-align: center;
            background: radial-gradient(ellipse at center, var(--orange-glow) 0%, transparent 70%);
        }

        .title-slide .slide-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .title-slide h1 {
            font-size: 4rem;
            font-weight: 700;
            color: var(--orange-primary);
            margin-bottom: 0.5rem;
            letter-spacing: 4px;
            text-shadow: 0 0 60px rgba(255, 107, 0, 0.3);
        }

        .title-slide .acronym {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
            text-align: center;
        }

        .title-slide .acronym span {
            color: var(--orange-primary);
            font-weight: 600;
        }

        .title-slide .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 3rem;
            letter-spacing: 1px;
            text-align: center;
        }

        .title-slide .authors {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 4rem;
            text-align: center;
        }

        .key-results {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            margin-top: 3rem;
            width: 100%;
            max-width: 1000px;
            align-items: stretch;
        }

        .result-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 2rem;
            text-align: center;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 120px;
        }

        .result-card:hover {
            border-color: var(--orange-dim);
            transform: translateY(-4px);
            box-shadow: 0 10px 40px rgba(255, 107, 0, 0.1);
        }

        .result-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--orange-primary);
            margin-bottom: 0.5rem;
        }

        .result-card .label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Section headers */
        h2 {
            font-size: 2rem;
            font-weight: 600;
            color: var(--orange-primary);
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--orange-dim);
            display: inline-block;
        }

        h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--orange-secondary);
            margin: 2rem 0 1rem;
        }

        h4 {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
            margin: 1.5rem 0 0.75rem;
        }

        /* Text */
        p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            max-width: 900px;
        }

        strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        em {
            color: var(--text-muted);
            font-style: italic;
        }

        /* Code blocks */
        pre {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-left: 3px solid var(--orange-primary);
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        code {
            color: var(--orange-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        pre code {
            color: var(--text-secondary);
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-size: 0.85rem;
        }

        th {
            background: var(--bg-tertiary);
            color: var(--orange-primary);
            text-align: left;
            padding: 1rem;
            border: 1px solid var(--border-color);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.75rem;
        }

        td {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        tr:hover td {
            background: var(--bg-secondary);
        }

        /* ASCII diagrams - FIXED */
        .diagram {
            background: var(--bg-primary);
            border: 1px solid var(--orange-dim);
            padding: 1.5rem;
            margin: 2rem 0;
            overflow-x: auto;
            font-size: 0.75rem;
            line-height: 1.3;
            color: var(--orange-secondary);
            position: relative;
            white-space: pre;
            font-family: 'JetBrains Mono', monospace;
        }

        .diagram::before {
            content: '┌─ DIAGRAM';
            position: absolute;
            top: -0.7rem;
            left: 1rem;
            background: var(--bg-primary);
            padding: 0 0.5rem;
            color: var(--orange-dim);
            font-size: 0.7rem;
            white-space: nowrap;
        }

        /* Lists */
        ul, ol {
            margin: 1rem 0 1rem 1.5rem;
            color: var(--text-secondary);
        }

        li {
            margin: 0.5rem 0;
            padding-left: 0.5rem;
        }

        li::marker {
            color: var(--orange-primary);
        }

        /* Inline highlights */
        .highlight {
            color: var(--orange-primary);
            font-weight: 500;
        }

        /* Section number */
        .section-num {
            display: inline-block;
            width: 2.5rem;
            height: 2.5rem;
            line-height: 2.5rem;
            text-align: center;
            background: var(--orange-primary);
            color: var(--bg-primary);
            font-weight: 700;
            margin-right: 1rem;
            font-size: 1rem;
        }

        /* Blockquote */
        blockquote {
            border-left: 3px solid var(--orange-primary);
            padding: 1rem 1.5rem;
            margin: 2rem 0;
            background: var(--orange-glow);
            color: var(--text-primary);
            font-style: italic;
        }

        /* Formula blocks */
        .formula {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-highlight);
            padding: 1.5rem 2rem;
            margin: 1.5rem 0;
            text-align: center;
            font-size: 1rem;
            color: var(--orange-secondary);
        }

        /* Grid layouts */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin: 2rem 0;
        }

        .three-col {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .four-col {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin: 2rem 0;
            align-items: stretch;
        }

        /* Metric box */
        .metric-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 120px;
        }

        .metric-box .value {
            font-size: 2.5rem;
            color: var(--orange-primary);
            font-weight: 700;
        }

        .metric-box .label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }

        .metric-box.small .value {
            font-size: 1.5rem;
        }

        /* Progress bars */
        .progress-item {
            margin: 1rem 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--orange-dim), var(--orange-primary));
        }

        /* Pipeline visualization */
        .pipeline {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin: 2rem 0;
        }

        .pipeline-stage {
            display: flex;
            align-items: stretch;
            position: relative;
        }

        .pipeline-label {
            width: 120px;
            flex-shrink: 0;
            padding: 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--orange-primary);
            font-weight: 600;
        }

        .pipeline-content {
            flex: 1;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-left: none;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .pipeline-box {
            background: var(--bg-primary);
            border: 2px solid var(--orange-dim);
            padding: 1rem 1.5rem;
            text-align: center;
            min-width: 150px;
        }

        .pipeline-box.highlight-box {
            border-color: var(--orange-primary);
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.2);
        }

        .pipeline-box .box-title {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .pipeline-box .box-value {
            font-size: 1rem;
            color: var(--orange-primary);
            font-weight: 600;
        }

        .pipeline-arrow {
            color: var(--orange-primary);
            font-size: 1.5rem;
            padding: 0 0.5rem;
        }

        /* Comparison boxes */
        .comparison {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 2rem;
            margin: 2rem 0;
            align-items: stretch;
        }

        .comparison-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        .comparison-box.bad {
            border-color: #ff4444;
        }

        .comparison-box.good {
            border-color: var(--orange-primary);
        }

        .comparison-box h4 {
            margin-top: 0;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .comparison-box.bad h4 {
            color: #ff6666;
        }

        .comparison-box.good h4 {
            color: var(--orange-primary);
        }

        .comparison-vs {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--text-muted);
            font-weight: 700;
        }

        .comparison-box ol {
            margin-left: 1.2rem;
        }

        .comparison-box li {
            margin: 0.75rem 0;
            font-size: 0.85rem;
        }

        /* Flow steps */
        .flow-step {
            display: flex;
            align-items: center;
            margin: 0.5rem 0;
            font-size: 0.85rem;
        }

        .flow-step .step-num {
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            background: var(--orange-dim);
            color: var(--bg-primary);
            font-size: 0.7rem;
            font-weight: 700;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .flow-step.bottleneck .step-num {
            background: #ff4444;
        }

        .flow-step.fast .step-num {
            background: var(--orange-primary);
        }

        /* Manhattan plot container */
        .manhattan-container {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            padding: 1rem;
            margin: 1.5rem 0;
            position: relative;
        }

        .manhattan-container::before {
            content: '┌─ MANHATTAN PLOT';
            position: absolute;
            top: -0.7rem;
            left: 1rem;
            background: var(--bg-primary);
            padding: 0 0.5rem;
            color: var(--orange-dim);
            font-size: 0.7rem;
        }

        #manhattan-canvas {
            width: 100%;
            height: 300px;
            display: block;
        }

        .qq-container {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            padding: 1rem;
            margin: 1.5rem 0;
            position: relative;
        }

        .qq-container::before {
            content: '┌─ QQ PLOT';
            position: absolute;
            top: -0.7rem;
            left: 1rem;
            background: var(--bg-primary);
            padding: 0 0.5rem;
            color: var(--orange-dim);
            font-size: 0.7rem;
        }

        #qq-canvas {
            width: 100%;
            height: 200px;
            display: block;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--orange-dim);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--orange-primary);
        }

        /* Appendix styles */
        .glossary-grid {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 0.5rem 2rem;
            margin: 1rem 0;
        }

        .glossary-term {
            color: var(--orange-primary);
            font-weight: 600;
        }

        .glossary-def {
            color: var(--text-secondary);
        }

        /* Animation */
        @keyframes glow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .pulse {
            animation: glow 2s ease-in-out infinite;
        }

        /* Footer - CENTERED */
        footer {
            padding: 4rem;
            text-align: center;
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        footer .logo {
            margin-bottom: 1rem;
        }

        footer p {
            text-align: center;
            max-width: none;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .slide {
                padding: 6rem 2rem 3rem;
            }

            .title-slide h1 {
                font-size: 2.5rem;
            }

            .key-results {
                grid-template-columns: repeat(2, 1fr);
            }

            .two-col, .three-col, .four-col, .comparison {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }

            h2 {
                font-size: 1.5rem;
            }

            .pipeline-stage {
                flex-direction: column;
            }

            .pipeline-label {
                width: 100%;
            }

            .pipeline-content {
                border-left: 1px solid var(--border-color);
                border-top: none;
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>

<nav>
    <div class="logo">ULTRALASSO</div>
    <div class="nav-links">
        <a href="#pipeline">Pipeline</a>
        <a href="#loco-concept">LOCO</a>
        <a href="#gwas">GWAS</a>
        <a href="#scaling">Scaling</a>
        <a href="#multi-pheno">Multi-Pheno</a>
        <a href="#results">Results</a>
    </div>
</nav>

<!-- Title Slide -->
<section class="slide title-slide">
    <div class="slide-content">
        <h1>UltraLasso</h1>
        <p class="acronym">
            <span>U</span>ltra-fast <span>L</span>arge-scale <span>T</span>ensor-accelerated <span>R</span>egression <span>A</span>rchitecture based on <span>LASSO</span>
        </p>
        <p class="subtitle">GPU-Acceleration Paradigm for Large-scale Genetic Association Studies</p>
        <p class="authors">
            <strong>Tuomo Kiiskinen</strong><br>
            January 2026 · Version 2.0
        </p>

        <div class="key-results">
            <div class="result-card">
                <div class="value">4.2 min</div>
                <div class="label">Full GWAS Runtime</div>
            </div>
            <div class="result-card">
                <div class="value">R² 0.80</div>
                <div class="label">LOCO Prediction</div>
            </div>
            <div class="result-card">
                <div class="value">1.04</div>
                <div class="label">Lambda GC</div>
            </div>
            <div class="result-card">
                <div class="value">9,156</div>
                <div class="label">GWS Hits</div>
            </div>
        </div>
    </div>
</section>

<!-- LOCO Concept Section -->
<section class="slide" id="loco-concept">
    <div class="slide-content">
        <h2><span class="section-num">★</span>Why LOCO? The Mixed Model Problem</h2>

        <p>Traditional GWAS suffers from confounding: population structure, cryptic relatedness, and polygenic background inflate test statistics. Mixed models solve this but require O(n²) GRM computation.</p>

        <h3>The LOCO Insight (regenie, 2021)</h3>
        <div class="two-col">
            <div>
                <h4>The Problem</h4>
                <div class="diagram"><strong>MIXED MODEL GWAS</strong>

y = Xβ + Zu + ε,  u ~ N(0, σ²K)

K = genetic relatedness matrix (n × n)

UK Biobank: 500K × 500K = <span style="color: #ff6666;">250 billion elements</span>
            = ~1 TB storage
            = O(n³) per SNP tested
            = <span style="color: #ff6666;">12-48 hours runtime</span></div>
            </div>
            <div>
                <h4>The Solution: LOCO Predictions</h4>
                <div class="diagram"><strong>LEAVE-ONE-CHROMOSOME-OUT</strong>

Instead of computing K, approximate the
polygenic effect with a predictor:

ŷ_LOCO[chr] = Σ β_j × x_j  (j ∉ chr)

This captures:
  ✓ Polygenic background
  ✓ Population structure  
  ✓ Cryptic relatedness

<span style="color: var(--orange-primary);">No n × n matrix needed!</span></div>
            </div>
        </div>

        <h3>Our Innovation: Sparse LOCO Beats Dense Ridge</h3>
        <div class="comparison">
            <div class="comparison-box">
                <h4>regenie (Dense Ridge)</h4>
                <ul>
                    <li>~500K-1M SNPs with non-zero β</li>
                    <li>Random/LD-pruned SNP selection</li>
                    <li><strong>Not phenotype-specific</strong></li>
                    <li>R² ≈ 0.70-0.72 for height</li>
                </ul>
            </div>
            <div style="display: flex; align-items: center; font-size: 2rem; color: var(--orange-primary);">→</div>
            <div class="comparison-box good">
                <h4>UltraLasso (Sparse LASSO)</h4>
                <ul>
                    <li>~25K SNPs with non-zero β</li>
                    <li>Phenotype-guided selection</li>
                    <li><strong>Optimized per trait</strong></li>
                    <li>R² ≈ <span class="highlight">0.80</span> for height</li>
                </ul>
            </div>
        </div>

        <blockquote>
            <strong>Key insight:</strong> Correction quality depends on <em>variance explained</em>, not predictor count. A smaller set of well-chosen SNPs outperforms a larger set of arbitrary SNPs.
        </blockquote>
    </div>
</section>

<!-- GWAS Results Section -->
<section class="slide" id="gwas">
    <div class="slide-content">
        <h2><span class="section-num">★</span>GPU-Native GWAS: Validated Results</h2>

        <p>Complete LOCO-based GWAS pipeline validated on UK Biobank height (INI50) with 235,503 samples and 1,059,798 array variants.</p>

        <h3>Key Metrics</h3>
        <div class="four-col">
            <div class="metric-box small">
                <div class="value">0.80</div>
                <div class="label">LOCO R²</div>
            </div>
            <div class="metric-box small">
                <div class="value">1.0425</div>
                <div class="label">Lambda GC</div>
            </div>
            <div class="metric-box small">
                <div class="value">9,156</div>
                <div class="label">GWS Hits</div>
            </div>
            <div class="metric-box small">
                <div class="value">4.2 min</div>
                <div class="label">Total Time</div>
            </div>
        </div>

        <h3>Manhattan Plot</h3>
        <div class="manhattan-container">
            <canvas id="manhattan-canvas"></canvas>
            <div style="display: flex; justify-content: center; gap: 2rem; margin-top: 0.5rem; font-size: 0.75rem;">
                <span><span style="color: #ff6b00;">●</span> GWS (P &lt; 5×10⁻⁸)</span>
                <span><span style="color: #444;">●</span> Non-significant</span>
                <span style="color: #666;">— GWS threshold (-log₁₀P = 7.3)</span>
            </div>
        </div>

        <div class="two-col">
            <div>
                <h3>QQ Plot</h3>
                <div class="qq-container">
                    <canvas id="qq-canvas"></canvas>
                </div>
                <p style="font-size: 0.8rem; color: var(--text-muted);">
                    λ_GC = 1.0425 indicates excellent calibration.<br>
                    Sparse LOCO provides equivalent correction to dense ridge.
                </p>
            </div>
            <div>
                <h3>Top Loci by Chromosome</h3>
                <table style="font-size: 0.75rem;">
                    <tr><th>Chr</th><th>GWS Hits</th><th>Top P-value</th></tr>
                    <tr><td>6 (HLA)</td><td class="highlight">3,125</td><td>1.3×10⁻¹⁰⁹</td></tr>
                    <tr><td>20</td><td>350</td><td class="highlight">6.3×10⁻²³⁰</td></tr>
                    <tr><td>3</td><td>375</td><td class="highlight">4.1×10⁻²¹⁹</td></tr>
                    <tr><td>4</td><td>347</td><td>1.9×10⁻¹⁵³</td></tr>
                    <tr><td>18</td><td>113</td><td>7.9×10⁻¹⁴⁶</td></tr>
                </table>
            </div>
        </div>

        <h3>Pipeline Timing Breakdown</h3>
        <div class="diagram"><strong>COMPLETE GWAS PIPELINE (4.2 minutes total)</strong>

Step 3: LOCO Model Training (2.6 min)
|-- Cupgen loading:           5.6s
|-- Full FISTA (29k SNPs):  127.2s  <-- Identifies active set
+-- 22x LOCO OLS:            22.7s  <-- Refit excluding each chr
                                        (No re-selection needed!)

Step 4: Association Testing (1.6 min)
|-- 22 chromosomes parallel
|-- 1,059,798 variants tested
+-- Throughput: 11,174 var/sec

===================================================================
TOTAL: 250.4 seconds (4.2 minutes)
===================================================================</div>
    </div>
</section>

<!-- Scaling Section -->
<section class="slide" id="scaling">
    <div class="slide-content">
        <h2><span class="section-num">★</span>Scaling: From Array to Imputed GWAS</h2>

        <p>Step 4 (GWAS) is <strong>embarrassingly parallel</strong> — each variant is independent. No chromosome boundaries required. We can split the genome into arbitrary equal-sized chunks.</p>

        <h3>Current Performance (Validated)</h3>
        <table>
            <tr>
                <th>Metric</th>
                <th>Value</th>
                <th>Notes</th>
            </tr>
            <tr>
                <td>GWAS throughput (H100)</td>
                <td class="highlight">11,174 var/sec</td>
                <td>Measured on array data</td>
            </tr>
            <tr>
                <td>GWAS throughput (L40)</td>
                <td>~4,000 var/sec</td>
                <td>Estimated (2.8× slower)</td>
            </tr>
            <tr>
                <td>Step 3 time (fixed)</td>
                <td>~2.5 min</td>
                <td>Independent of GWAS variants</td>
            </tr>
        </table>

        <h3>Projected Scaling: 20M Imputed Variants</h3>
        <table>
            <tr>
                <th>Configuration</th>
                <th>Variants/GPU</th>
                <th>Step 4 Time</th>
                <th>Total Time</th>
            </tr>
            <tr>
                <td>1× H100</td>
                <td>20M</td>
                <td>~30 min</td>
                <td class="highlight">~33 min</td>
            </tr>
            <tr>
                <td>8× H100</td>
                <td>2.5M</td>
                <td>~3.7 min</td>
                <td class="highlight">~6 min</td>
            </tr>
            <tr>
                <td>25× L40</td>
                <td>800K</td>
                <td>~3.3 min</td>
                <td class="highlight">~6 min</td>
            </tr>
            <tr>
                <td>50× L40</td>
                <td>400K</td>
                <td>~1.7 min</td>
                <td class="highlight">~4 min</td>
            </tr>
            <tr>
                <td>100× L40</td>
                <td>200K</td>
                <td>~50 sec</td>
                <td class="highlight">~3.5 min</td>
            </tr>
        </table>
        <p><em>At 100 L40s, the pipeline becomes limited by Step 3 (~2.5 min), not Step 4.</em></p>

        <h3>Cloud-Burst Architecture</h3>
        <div class="diagram"><strong>MULTI-GPU SCALING STRATEGY</strong>

Each worker only needs:
|-- LOCO predictions: 235K x 22 x 4 bytes = <span style="color: var(--orange-primary);">21 MB</span> (broadcast once)
+-- Its genotype chunk: streamed from NVMe

Workflow:
+--------------------------------------------------------------+
|  1. Run Step 3 on single H100 (~2.5 min)                     |
|  2. Broadcast 21 MB LOCO predictions to N workers            |
|  3. Scatter cupgen chunks across workers                     |
|  4. Run Step 4 in parallel (~2-3 min)                        |
|  5. Collect and merge results                                |
+--------------------------------------------------------------+

<span style="color: var(--orange-primary);">Full biobank-scale GWAS (500K x 20M) in under 5 minutes for $10-20 cloud compute.</span></div>

        <h3>Comparison to Traditional Methods</h3>
        <table>
            <tr>
                <th>Method</th>
                <th>Runtime</th>
                <th>LOCO R²</th>
                <th>Speedup</th>
            </tr>
            <tr>
                <td>BOLT-LMM</td>
                <td>12-48 hours</td>
                <td>~0.70</td>
                <td>—</td>
            </tr>
            <tr>
                <td>SAIGE</td>
                <td>6-24 hours</td>
                <td>~0.70</td>
                <td>—</td>
            </tr>
            <tr>
                <td>regenie</td>
                <td>3-6 hours</td>
                <td>~0.70-0.72</td>
                <td>—</td>
            </tr>
            <tr class="highlight">
                <td><strong>UltraLasso</strong></td>
                <td><strong>4.2 min</strong></td>
                <td><strong>0.80</strong></td>
                <td><strong>43-690×</strong></td>
            </tr>
        </table>
    </div>
</section>

<!-- Multi-Phenotype Scaling Section -->
<section class="slide" id="multi-pheno">
    <div class="slide-content">
        <h2><span class="section-num">★</span>The Real Win: Multi-Phenotype Batching</h2>

        <blockquote>
            <strong>Key insight:</strong> I/O is the bottleneck, not compute. Reading genotypes costs the same whether you compute 1 phenotype or 100. Adding phenotypes is <em>nearly free</em>.
        </blockquote>

        <h3>Why Multi-Phenotype Scales Sublinearly</h3>
        <div class="two-col">
            <div>
                <h4>Single Phenotype Breakdown</h4>
                <div class="progress-item">
                    <div class="progress-label"><span>I/O (read cupgen)</span><span class="highlight">~60%</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 60%"></div></div>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>Compute (stats)</span><span>~35%</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 35%"></div></div>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>Overhead</span><span>~5%</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 5%"></div></div>
                </div>
            </div>
            <div>
                <h4>Batched: N Phenotypes</h4>
                <div class="progress-item">
                    <div class="progress-label"><span>I/O (read once)</span><span class="highlight">SAME</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 60%"></div></div>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>Compute × N</span><span>~1.5× for 100 phenos</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 50%"></div></div>
                </div>
                <div class="progress-item">
                    <div class="progress-label"><span>Overhead</span><span>~5%</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width: 5%"></div></div>
                </div>
            </div>
        </div>

        <h3>Multi-Phenotype Architecture (8 GPUs x 8 Phenotypes)</h3>
        <div class="diagram"><strong>BATCHED MULTI-PHENOTYPE GWAS</strong>

<span style="color: var(--orange-primary);">Step 1+2+4: I/O-bound -> Batch phenotypes per GPU chunk</span>
+----------------------------------------------------------------+
|  GPU 0: Genome chunk 1/8 -> Compute stats for ALL 8 phenotypes |
|  GPU 1: Genome chunk 2/8 -> Compute stats for ALL 8 phenotypes |
|  ...                                                           |
|  GPU 7: Genome chunk 8/8 -> Compute stats for ALL 8 phenotypes |
+----------------------------------------------------------------+
                   v One cupgen read serves 8 phenotypes!

<span style="color: var(--orange-primary);">Step 3: Compute-bound -> Distribute phenotypes across GPUs</span>
+----------------------------------------------------------------+
|  GPU 0-2: Phenotypes 1-3 (FISTA + LOCO)                        |
|  GPU 3-5: Phenotypes 4-6 (FISTA + LOCO)                        |
|  GPU 6-7: Phenotypes 7-8 (FISTA + LOCO)                        |
+----------------------------------------------------------------+
                   v Each phenotype needs its own LOCO model

<span style="color: var(--orange-primary);">Result: 8 complete GWAS in ~8-10 minutes (vs 8 x 4.2 = 34 min naive)</span></div>

        <h3>Scaling Efficiency</h3>
        <table>
            <tr>
                <th>Phenotypes</th>
                <th>Naive Time</th>
                <th>Batched Time</th>
                <th>Efficiency</th>
            </tr>
            <tr>
                <td>1</td>
                <td>4.2 min</td>
                <td>4.2 min</td>
                <td>1×</td>
            </tr>
            <tr>
                <td>8 (on 8 GPUs)</td>
                <td>34 min</td>
                <td class="highlight">~8 min</td>
                <td class="highlight">4×</td>
            </tr>
            <tr>
                <td>100 (on 8 GPUs)</td>
                <td>7 hours</td>
                <td class="highlight">~20 min</td>
                <td class="highlight">21×</td>
            </tr>
            <tr>
                <td>1000 (on 8 GPUs)</td>
                <td>70 hours</td>
                <td class="highlight">~2 hours</td>
                <td class="highlight">35×</td>
            </tr>
            <tr>
                <td>3000 (FinnGen-scale)</td>
                <td>~9 days</td>
                <td class="highlight">~4-6 hours</td>
                <td class="highlight">36-54×</td>
            </tr>
        </table>

        <h3>Why This Matters</h3>
        <div class="three-col">
            <div class="metric-box">
                <div class="value" style="font-size: 1.3rem;">PheWAS</div>
                <div class="label">3000 phenotypes in hours</div>
            </div>
            <div class="metric-box">
                <div class="value" style="font-size: 1.3rem;">Sensitivity</div>
                <div class="label">Run 10 covariate models free</div>
            </div>
            <div class="metric-box">
                <div class="value" style="font-size: 1.3rem;">Interactive</div>
                <div class="label">Same-day iteration</div>
            </div>
        </div>

        <p style="margin-top: 2rem;"><strong>Bottom line:</strong> A single GWAS in 4 minutes is impressive. But 3000 phenotypes in 4-6 hours — that's <em>transformative</em>. It makes rigorous genetic epidemiology (sensitivity analyses, stratification, conditional GWAS) computationally feasible for the first time.</p>
    </div>
</section>

<!-- Pipeline Overview -->
<section class="slide" id="pipeline">
    <div class="slide-content">
        <h2><span class="section-num">0</span>Pipeline Overview</h2>

        <p>UltraLasso transforms raw genotype data into polygenic risk scores and GWAS results through a GPU-accelerated pipeline:</p>

        <div class="pipeline">
            <div class="pipeline-stage">
                <div class="pipeline-label">Input</div>
                <div class="pipeline-content">
                    <div class="pipeline-box">
                        <div class="box-title">PGEN Files</div>
                        <div class="box-value">~150 GB</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box highlight-box">
                        <div class="box-title">Convert to</div>
                        <div class="box-value">.cupgen</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box">
                        <div class="box-title">GPU-Native</div>
                        <div class="box-value">~62 GB</div>
                    </div>
                </div>
            </div>

            <div class="pipeline-stage">
                <div class="pipeline-label">Step 1+2<br><small>Per Chr</small></div>
                <div class="pipeline-content">
                    <div class="pipeline-box">
                        <div class="box-title">Stream</div>
                        <div class="box-value">~50K SNPs</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box">
                        <div class="box-title">Univariate</div>
                        <div class="box-value">β̂, SE, LOO</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box">
                        <div class="box-title">Top-K Select</div>
                        <div class="box-value">Chainsaw</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box highlight-box">
                        <div class="box-title">LASSO</div>
                        <div class="box-value">~1-2K kept</div>
                    </div>
                </div>
            </div>

            <div class="pipeline-stage">
                <div class="pipeline-label">Step 3<br><small>LOCO</small></div>
                <div class="pipeline-content">
                    <div class="pipeline-box">
                        <div class="box-title">Collect</div>
                        <div class="box-value">22 × Chr</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box">
                        <div class="box-title">Joint FISTA</div>
                        <div class="box-value">~29K SNPs</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box highlight-box">
                        <div class="box-title">22× LOCO OLS</div>
                        <div class="box-value">R² = 0.80</div>
                    </div>
                </div>
            </div>

            <div class="pipeline-stage">
                <div class="pipeline-label">Step 4<br><small>GWAS</small></div>
                <div class="pipeline-content">
                    <div class="pipeline-box">
                        <div class="box-title">Residualize</div>
                        <div class="box-value">y - ŷ_LOCO</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box">
                        <div class="box-title">Test All</div>
                        <div class="box-value">1.06M var</div>
                    </div>
                    <span class="pipeline-arrow">→</span>
                    <div class="pipeline-box highlight-box">
                        <div class="box-title">Output</div>
                        <div class="box-value">λ_GC=1.04</div>
                    </div>
                </div>
            </div>
        </div>

        <h3>Key Innovations</h3>
        <div class="three-col">
            <div class="metric-box">
                <div class="value" style="font-size: 1.5rem;">.cupgen</div>
                <div class="label">GPU-Native Format</div>
            </div>
            <div class="metric-box">
                <div class="value" style="font-size: 1.5rem;">LOCO OLS</div>
                <div class="label">6× Faster than FISTA</div>
            </div>
            <div class="metric-box">
                <div class="value" style="font-size: 1.5rem;">Streaming</div>
                <div class="label">Memory-Efficient</div>
            </div>
        </div>
    </div>
</section>

<!-- Results Section -->
<section class="slide" id="results">
    <div class="slide-content">
        <h2><span class="section-num">10</span>Performance Summary</h2>

        <h3>Predictive Performance</h3>
        <table>
            <tr>
                <th>Method</th>
                <th>SNPs</th>
                <th>LOCO R²</th>
                <th>λ_GC</th>
                <th>Runtime</th>
            </tr>
            <tr>
                <td>regenie (ridge)</td>
                <td>~500K-1M</td>
                <td>~0.70-0.72</td>
                <td>~1.01</td>
                <td>3-6 hours</td>
            </tr>
            <tr>
                <td>BOLT-LMM</td>
                <td>all</td>
                <td>~0.70</td>
                <td>~1.01</td>
                <td>12-48 hours</td>
            </tr>
            <tr class="highlight">
                <td><strong>UltraLasso</strong></td>
                <td><strong>29K</strong></td>
                <td><strong>0.80</strong></td>
                <td><strong>1.04</strong></td>
                <td><strong>4.2 min</strong></td>
            </tr>
        </table>

        <blockquote>
            <strong>Key finding:</strong> Phenotype-guided sparse selection (29K SNPs) <em>outperforms</em> phenotype-agnostic dense ridge (~1M SNPs) while being orders of magnitude faster.
        </blockquote>

        <h3>Throughput Metrics</h3>
        <div class="two-col">
            <div>
                <table>
                    <tr><th>Metric</th><th>Value</th></tr>
                    <tr><td>Total variants processed</td><td>1,059,798</td></tr>
                    <tr><td>Samples</td><td>235,503</td></tr>
                    <tr><td>Genotype calls</td><td class="highlight">249.6 billion</td></tr>
                    <tr><td>GWAS throughput</td><td class="highlight">11,174 var/sec</td></tr>
                </table>
            </div>
            <div>
                <div class="metric-box" style="margin-top: 0;">
                    <div class="value">43-690×</div>
                    <div class="label">Speedup vs Traditional</div>
                </div>
            </div>
        </div>

        <h3>Why Sparse LOCO Works</h3>
        <p>The LOCO prediction captures polygenic background, population structure, and cryptic relatedness. What matters for GWAS correction is the <strong>variance explained</strong>, not the number of SNPs used.</p>

        <ul>
            <li><strong>regenie:</strong> Random/LD-pruned selection → ~500K-1M SNPs → R² ≈ 0.70</li>
            <li><strong>UltraLasso:</strong> Phenotype-guided selection → ~29K SNPs → R² = <strong>0.80</strong></li>
        </ul>
        <p>Fewer, better-chosen SNPs achieve higher prediction accuracy.</p>
    </div>
</section>

<!-- Appendix -->
<section class="slide">
    <div class="slide-content">
        <h2><span class="section-num">A</span>Technical Details & References</h2>

        <h3>LOCO via OLS (Key Optimization)</h3>
        <p>FISTA performs two functions: (1) feature selection and (2) coefficient estimation. For LOCO, we don't repeat selection — the full model already identified which SNPs matter.</p>

        <pre><code>Step 3.0: Run FISTA on all chromosomes (~500 iterations)
          → Get active set A = {j : βⱼ ≠ 0}

Step 3.i: For LOCO excluding chromosome i:
          → Active set = A - {SNPs on chr i}
          → Run OLS (closed-form) instead of FISTA
          → (X'X)β = X'y, single matrix solve

Time: 22 × FISTA → 1 × FISTA + 22 × OLS
      ~45 min   → ~8 min (6× speedup)</code></pre>

        <h3>Glossary</h3>
        <div class="glossary-grid">
            <span class="glossary-term">LOCO</span>
            <span class="glossary-def">Leave-One-Chromosome-Out (prevents proximal contamination)</span>

            <span class="glossary-term">λ_GC</span>
            <span class="glossary-def">Genomic inflation factor (should be ~1.0 for well-calibrated GWAS)</span>

            <span class="glossary-term">GWS</span>
            <span class="glossary-def">Genome-wide significant (P < 5×10⁻⁸)</span>

            <span class="glossary-term">FISTA</span>
            <span class="glossary-def">Fast Iterative Shrinkage-Thresholding Algorithm</span>

            <span class="glossary-term">.cupgen</span>
            <span class="glossary-def">CUDA-optimized Packed GENotypes format</span>
        </div>

        <h3>References</h3>
        <ol style="font-size: 0.85rem; color: var(--text-muted);">
            <li>Mbatchou, J. et al. (2021). Computationally efficient whole-genome regression. Nature Genetics.</li>
            <li>Chatterjee, S., Hastie, T., & Tibshirani, R. (2025). Univariate-guided sparse regression. HDSR. <a href="https://arxiv.org/abs/2511.22049v3" style="color: var(--orange-secondary);">arXiv:2511.22049</a></li>
            <li>Loh, P.-R. et al. (2015). Efficient Bayesian mixed-model analysis. Nature Genetics.</li>
        </ol>
    </div>
</section>

<footer>
    <div class="logo pulse">ULTRALASSO</div>
    <p>
        <span style="color: var(--orange-primary);">U</span>ltra-fast
        <span style="color: var(--orange-primary);">L</span>arge-scale
        <span style="color: var(--orange-primary);">T</span>ensor-accelerated
        <span style="color: var(--orange-primary);">R</span>egression
        <span style="color: var(--orange-primary);">A</span>rchitecture based on
        <span style="color: var(--orange-primary);">LASSO</span>
    </p>
    <p style="margin-top: 1rem;">Report: January 20, 2026 · Version 2.0 with validated GWAS results</p>
</footer>

<script>
// GWAS visualization data (binned for efficient rendering)
const GWAS_DATA={"bins":[[0,1,151,1],[1,1,122,1],[2,1,500,1],[3,1,145,1],[4,1,174,1],[5,1,113,1],[6,1,481,1],[7,1,139,1],[8,1,223,1],[9,1,66,0],[10,1,114,1],[11,1,40,0],[12,1,229,1],[13,1,76,1],[14,1,304,1],[15,1,65,0],[16,1,93,1],[17,1,45,0],[18,1,22,0],[19,1,170,1],[23,1,69,0],[24,1,798,1],[25,1,94,1],[26,1,11,0],[27,1,484,1],[28,1,58,0],[29,1,243,1],[30,1,8,0],[31,1,19,0],[32,1,104,1],[33,1,215,1],[34,1,109,1],[35,1,410,1],[36,1,202,1],[37,1,50,0],[38,1,94,1],[39,1,97,1],[40,1,10,0],[41,2,49,0],[42,2,82,1],[43,2,194,1],[44,2,30,0],[45,2,281,1],[46,2,360,1],[47,2,238,1],[48,2,87,1],[49,2,114,1],[50,2,71,0],[51,2,293,1],[52,2,81,1],[53,2,140,1],[54,2,62,0],[55,2,73,1],[56,2,207,1],[57,2,159,1],[58,2,60,0],[59,2,96,1],[60,2,73,1],[61,2,257,1],[62,2,54,0],[63,2,54,0],[64,2,56,0],[65,2,15,0],[66,2,23,0],[67,2,78,1],[68,2,42,0],[69,2,164,1],[70,2,54,0],[71,2,86,1],[72,2,56,0],[73,2,80,1],[74,2,113,1],[75,2,12,0],[76,2,40,0],[77,2,235,1],[78,2,82,1],[79,2,305,1],[80,2,84,1],[81,2,177,1],[82,3,14,0],[83,3,13,0],[84,3,125,1],[85,3,60,0],[86,3,51,0],[87,3,41,0],[88,3,87,1],[89,3,171,1],[90,3,157,1],[91,3,290,1],[92,3,234,1],[93,3,17,0],[94,3,275,1],[95,3,20,0],[96,3,46,0],[97,3,12,0],[98,3,75,1],[99,3,75,1],[100,3,69,0],[101,3,109,1],[102,3,60,0],[103,3,114,1],[104,3,295,1],[105,3,2139,1],[106,3,84,1],[107,3,72,0],[108,3,154,1],[109,3,56,0],[110,3,102,1],[111,3,10,0],[112,3,182,1],[113,3,52,0],[114,3,62,0],[116,4,186,1],[117,4,104,1],[118,4,186,1],[119,4,918,1],[120,4,131,1],[121,4,15,0],[122,4,65,0],[123,4,75,1],[124,4,129,1],[125,4,318,1],[126,4,14,0],[127,4,16,0],[128,4,260,1],[129,4,653,1],[130,4,125,1],[131,4,14,0],[132,4,82,1],[133,4,299,1],[134,4,127,1],[135,4,17,0],[136,4,168,1],[137,4,19,0],[138,4,47,0],[139,4,121,1],[140,4,1526,1],[141,4,15,0],[142,4,30,0],[143,4,19,0],[144,4,8,0],[145,4,13,0],[146,4,153,1],[147,4,17,0],[149,5,72,0],[150,5,78,1],[151,5,24,0],[152,5,17,0],[153,5,9,0],[154,5,205,1],[155,5,260,1],[156,5,88,1],[157,5,323,1],[158,5,325,1],[159,5,95,1],[160,5,101,1],[161,5,85,1],[162,5,42,0],[163,5,255,1],[164,5,48,0],[165,5,92,1],[166,5,204,1],[167,5,168,1],[168,5,77,1],[169,5,77,1],[170,5,463,1],[171,5,75,1],[172,5,51,0],[173,5,18,0],[174,5,54,0],[175,5,13,0],[176,5,560,1],[177,5,224,1],[178,5,205,1],[180,6,74,1],[181,6,472,1],[182,6,23,0],[183,6,1067,1],[184,6,1045,1],[185,6,1084,1],[186,6,116,1],[187,6,153,1],[188,6,23,0],[189,6,12,0],[190,6,55,0],[191,6,72,0],[192,6,242,1],[193,6,251,1],[194,6,24,0],[195,6,10,0],[196,6,78,1],[197,6,615,1],[198,6,175,1],[199,6,78,1],[200,6,737,1],[201,6,184,1],[202,6,121,1],[203,6,925,1],[204,6,365,1],[205,6,137,1],[206,6,89,1],[207,6,270,1],[209,7,135,1],[210,7,185,1],[211,7,80,1],[212,7,233,1],[213,7,640,1],[214,7,92,1],[215,7,45,0],[216,7,97,1],[217,7,70,0],[218,7,65,0],[219,7,89,1],[220,7,45,0],[221,7,48,0],[222,7,23,0],[223,7,74,1],[224,7,454,1],[225,7,82,1],[226,7,21,0],[227,7,10,0],[228,7,67,0],[229,7,10,0],[230,7,113,1],[231,7,136,1],[232,7,41,0],[233,7,290,1],[234,7,18,0],[235,7,5,0],[236,8,14,0],[237,8,54,0],[238,8,100,1],[239,8,38,0],[240,8,268,1],[241,8,16,0],[242,8,52,0],[243,8,20,0],[244,8,45,0],[245,8,526,1],[246,8,46,0],[247,8,26,0],[248,8,99,1],[249,8,175,1],[250,8,55,0],[251,8,42,0],[252,8,43,0],[253,8,36,0],[254,8,53,0],[255,8,79,1],[256,8,167,1],[257,8,462,1],[258,8,432,1],[259,8,72,0],[260,8,149,1],[261,9,1,0],[262,9,43,0],[263,9,10,0],[264,9,59,0],[265,9,91,1],[266,9,10,0],[267,9,90,1],[268,9,11,0],[273,9,32,0],[274,9,415,1],[275,9,57,0],[276,9,144,1],[277,9,310,1],[278,9,79,1],[279,9,134,1],[280,9,82,1],[281,9,371,1],[282,9,108,1],[283,9,267,1],[284,9,294,1],[286,10,17,0],[287,10,128,1],[288,10,206,1],[289,10,10,0],[290,10,68,0],[291,10,96,1],[292,10,7,0],[293,10,8,0],[294,10,57,0],[295,10,32,0],[296,10,147,1],[297,10,176,1],[298,10,19,0],[299,10,167,1],[300,10,45,0],[301,10,99,1],[302,10,110,1],[303,10,303,1],[304,10,31,0],[305,10,89,1],[306,10,148,1],[307,10,48,0],[308,10,12,0],[309,11,45,0],[310,11,276,1],[311,11,47,0],[312,11,147,1],[313,11,79,1],[314,11,77,1],[315,11,37,0],[316,11,12,0],[317,11,213,1],[318,11,78,1],[319,11,91,1],[320,11,628,1],[321,11,118,1],[322,11,465,1],[323,11,52,0],[324,11,77,1],[325,11,54,0],[326,11,43,0],[327,11,8,0],[328,11,43,0],[329,11,102,1],[330,11,106,1],[331,11,22,0],[333,12,282,1],[334,12,93,1],[335,12,142,1],[336,12,117,1],[337,12,390,1],[338,12,493,1],[339,12,8,0],[340,12,94,1],[341,12,114,1],[342,12,114,1],[343,12,75,1],[344,12,1175,1],[345,12,75,1],[346,12,55,0],[347,12,40,0],[348,12,559,1],[349,12,63,0],[350,12,180,1],[351,12,58,0],[352,12,154,1],[353,12,170,1],[354,12,47,0],[355,12,80,1],[359,13,4,0],[360,13,117,1],[361,13,83,1],[362,13,77,1],[363,13,106,1],[364,13,863,1],[365,13,136,1],[366,13,37,0],[367,13,12,0],[368,13,74,1],[369,13,56,0],[370,13,58,0],[371,13,20,0],[372,13,133,1],[373,13,67,0],[374,13,14,0],[375,13,153,1],[380,14,242,1],[381,14,13,0],[382,14,97,1],[383,14,39,0],[384,14,9,0],[385,14,118,1],[386,14,449,1],[387,14,219,1],[388,14,124,1],[389,14,117,1],[390,14,51,0],[391,14,347,1],[392,14,90,1],[393,14,212,1],[394,14,82,1],[399,15,10,0],[400,15,6,0],[401,15,8,0],[402,15,176,1],[403,15,185,1],[404,15,182,1],[405,15,56,0],[406,15,168,1],[407,15,241,1],[408,15,207,1],[409,15,991,1],[410,15,338,1],[411,15,85,1],[412,15,309,1],[414,16,346,1],[415,16,61,0],[416,16,179,1],[417,16,74,1],[418,16,121,1],[419,16,164,1],[421,16,4,0],[422,16,81,1],[423,16,14,0],[424,16,7,0],[425,16,190,1],[426,16,104,1],[427,16,148,1],[428,16,163,1],[430,17,111,1],[431,17,341,1],[432,17,15,0],[433,17,224,1],[434,17,81,1],[435,17,986,1],[436,17,164,1],[437,17,253,1],[438,17,199,1],[439,17,819,1],[440,17,751,1],[441,17,138,1],[442,17,101,1],[443,17,156,1],[445,18,48,0],[446,18,47,0],[447,18,49,0],[448,18,1084,1],[449,18,26,0],[450,18,4,0],[451,18,48,0],[452,18,378,1],[453,18,75,1],[454,18,179,1],[455,18,26,0],[456,18,20,0],[457,18,33,0],[459,19,464,1],[460,19,197,1],[461,19,172,1],[462,19,136,1],[463,19,6,0],[464,19,41,0],[465,19,125,1],[466,19,219,1],[467,19,95,1],[468,19,261,1],[470,20,25,0],[471,20,132,1],[472,20,29,0],[473,20,47,0],[474,20,27,0],[475,20,324,1],[476,20,2292,1],[477,20,84,1],[478,20,340,1],[479,20,119,1],[480,20,52,0],[484,21,10,0],[485,21,16,0],[486,21,17,0],[487,21,50,0],[488,21,149,1],[489,21,80,1],[490,21,87,1],[494,22,43,0],[495,22,14,0],[496,22,123,1],[497,22,138,1],[498,22,124,1],[499,22,139,1]],"chr_mids":{"1":0.040,"2":0.123,"3":0.198,"4":0.264,"5":0.327,"6":0.388,"7":0.444,"8":0.497,"9":0.547,"10":0.595,"11":0.642,"12":0.688,"13":0.735,"14":0.775,"15":0.812,"16":0.843,"17":0.874,"18":0.903,"19":0.928,"20":0.951,"21":0.975,"22":0.994},"gws_thresh":73,"n_bins":500};

// QQ data (sampled)
const QQ_DATA = {
    e: [5.84,4.40,4.10,3.93,3.81,3.71,3.63,3.57,3.51,3.46,3.41,3.37,3.33,3.30,3.27,3.24,3.21,3.18,3.16,3.13,3.11,3.09,3.07,3.05,3.03,3.01,3.00,2.98,2.96,2.95,2.93,2.92,2.91,2.89,2.88,2.87,2.86,2.84,1.84,1.55,1.38,1.26,1.16,1.09,1.02,0.96,0.91,0.87,0.83,0.79,0.75,0.72,0.69,0.66,0.64,0.61,0.59,0.57,0.55,0.53,0.51,0.49,0.47,0.45,0.44,0.42,0.41,0.39,0.38,0.37,0.35,0.34,0.32,0.31,0.30,0.29,0.28,0.27,0.26,0.25,0.24,0.23,0.22,0.21,0.20,0.19,0.18,0.17,0.16,0.15,0.14,0.14,0.13,0.12,0.11,0.10,0.10,0.09,0.08,0.08,0.07,0.06,0.06,0.05,0.05,0.04,0.04,0.03,0.02,0.02,0.01],
    o: [229.2,115.0,97.3,86.5,79.5,70.7,64.5,61.2,57.1,52.1,50.3,48.5,46.6,45.3,43.7,42.2,41.2,39.7,38.9,37.2,36.2,35.2,34.6,34.1,33.6,32.9,32.3,32.0,31.5,30.9,30.5,30.1,29.7,29.4,29.0,28.7,28.3,28.0,6.71,4.18,3.18,2.63,2.28,2.03,1.84,1.69,1.56,1.46,1.36,1.28,1.21,1.15,1.09,1.03,0.98,0.94,0.90,0.86,0.82,0.78,0.75,0.72,0.69,0.66,0.64,0.61,0.59,0.56,0.54,0.52,0.50,0.48,0.46,0.44,0.42,0.40,0.39,0.37,0.35,0.34,0.32,0.31,0.30,0.28,0.27,0.26,0.24,0.23,0.22,0.21,0.19,0.18,0.17,0.16,0.15,0.14,0.13,0.12,0.11,0.10,0.09,0.08,0.07,0.06,0.06,0.05,0.04,0.03,0.02,0.02,0.01]
};

// Draw Manhattan plot
function drawManhattan() {
    const canvas = document.getElementById('manhattan-canvas');
    const ctx = canvas.getContext('2d');

    // Set canvas size with device pixel ratio for sharp rendering
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);

    const width = rect.width;
    const height = rect.height;
    const padding = {top: 20, right: 20, bottom: 40, left: 50};
    const plotWidth = width - padding.left - padding.right;
    const plotHeight = height - padding.top - padding.bottom;

    // Clear
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, width, height);

    // Find max Y (cap at 100 for display)
    const maxY = 100;
    const gwsThresh = GWAS_DATA.gws_thresh / 10; // Convert back from stored format

    // Draw grid lines
    ctx.strokeStyle = '#222';
    ctx.lineWidth = 1;
    for (let y = 0; y <= maxY; y += 20) {
        const yPos = padding.top + plotHeight - (y / maxY * plotHeight);
        ctx.beginPath();
        ctx.moveTo(padding.left, yPos);
        ctx.lineTo(width - padding.right, yPos);
        ctx.stroke();
    }

    // Draw GWS threshold line
    const threshY = padding.top + plotHeight - (gwsThresh / maxY * plotHeight);
    ctx.strokeStyle = '#444';
    ctx.setLineDash([5, 5]);
    ctx.beginPath();
    ctx.moveTo(padding.left, threshY);
    ctx.lineTo(width - padding.right, threshY);
    ctx.stroke();
    ctx.setLineDash([]);

    // Draw points
    const nBins = GWAS_DATA.n_bins;
    GWAS_DATA.bins.forEach(bin => {
        const [binIdx, chr, pVal10, isGws] = bin;
        const x = padding.left + (binIdx / nBins) * plotWidth;
        const y = Math.min(pVal10 / 10, maxY); // Convert back and cap
        const yPos = padding.top + plotHeight - (y / maxY * plotHeight);

        // Color: orange for GWS, alternating grays for chromosomes
        if (isGws) {
            ctx.fillStyle = '#ff6b00';
        } else {
            ctx.fillStyle = chr % 2 === 0 ? '#333' : '#555';
        }

        // Draw bar instead of point for bin visualization
        const barWidth = Math.max(2, plotWidth / nBins * 0.8);
        ctx.fillRect(x - barWidth/2, yPos, barWidth, plotHeight - (yPos - padding.top));
    });

    // Draw axes
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(padding.left, padding.top);
    ctx.lineTo(padding.left, height - padding.bottom);
    ctx.lineTo(width - padding.right, height - padding.bottom);
    ctx.stroke();

    // Y-axis labels
    ctx.fillStyle = '#888';
    ctx.font = '10px JetBrains Mono';
    ctx.textAlign = 'right';
    for (let y = 0; y <= maxY; y += 20) {
        const yPos = padding.top + plotHeight - (y / maxY * plotHeight);
        ctx.fillText(y.toString(), padding.left - 5, yPos + 3);
    }
    ctx.save();
    ctx.translate(15, height/2);
    ctx.rotate(-Math.PI/2);
    ctx.textAlign = 'center';
    ctx.fillText('-log₁₀(P)', 0, 0);
    ctx.restore();

    // Chromosome labels
    ctx.textAlign = 'center';
    Object.entries(GWAS_DATA.chr_mids).forEach(([chr, pos]) => {
        const x = padding.left + pos * plotWidth;
        if (parseInt(chr) % 2 === 1 || parseInt(chr) > 18) {
            ctx.fillText(chr, x, height - padding.bottom + 15);
        }
    });
    ctx.fillText('Chromosome', width/2, height - 5);
}

// Draw QQ plot
function drawQQ() {
    const canvas = document.getElementById('qq-canvas');
    const ctx = canvas.getContext('2d');

    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);

    const width = rect.width;
    const height = rect.height;
    const padding = {top: 20, right: 20, bottom: 40, left: 50};
    const plotWidth = width - padding.left - padding.right;
    const plotHeight = height - padding.top - padding.bottom;

    // Clear
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, width, height);

    // Max values (cap for display)
    const maxVal = 10;

    // Draw grid
    ctx.strokeStyle = '#222';
    ctx.lineWidth = 1;
    for (let v = 0; v <= maxVal; v += 2) {
        const pos = v / maxVal;
        // Horizontal
        ctx.beginPath();
        ctx.moveTo(padding.left, padding.top + plotHeight * (1 - pos));
        ctx.lineTo(width - padding.right, padding.top + plotHeight * (1 - pos));
        ctx.stroke();
        // Vertical
        ctx.beginPath();
        ctx.moveTo(padding.left + plotWidth * pos, padding.top);
        ctx.lineTo(padding.left + plotWidth * pos, height - padding.bottom);
        ctx.stroke();
    }

    // Draw diagonal (expected line)
    ctx.strokeStyle = '#666';
    ctx.setLineDash([3, 3]);
    ctx.beginPath();
    ctx.moveTo(padding.left, height - padding.bottom);
    ctx.lineTo(width - padding.right, padding.top);
    ctx.stroke();
    ctx.setLineDash([]);

    // Draw QQ points
    ctx.fillStyle = '#ff6b00';
    for (let i = 0; i < QQ_DATA.e.length; i++) {
        const e = Math.min(QQ_DATA.e[i], maxVal);
        const o = Math.min(QQ_DATA.o[i], maxVal);
        const x = padding.left + (e / maxVal) * plotWidth;
        const y = padding.top + plotHeight - (o / maxVal) * plotHeight;

        ctx.beginPath();
        ctx.arc(x, y, 2, 0, Math.PI * 2);
        ctx.fill();
    }

    // Axes
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(padding.left, padding.top);
    ctx.lineTo(padding.left, height - padding.bottom);
    ctx.lineTo(width - padding.right, height - padding.bottom);
    ctx.stroke();

    // Labels
    ctx.fillStyle = '#888';
    ctx.font = '10px JetBrains Mono';
    ctx.textAlign = 'right';
    for (let v = 0; v <= maxVal; v += 2) {
        const yPos = padding.top + plotHeight * (1 - v/maxVal);
        ctx.fillText(v.toString(), padding.left - 5, yPos + 3);
    }
    ctx.textAlign = 'center';
    for (let v = 0; v <= maxVal; v += 2) {
        const xPos = padding.left + (v/maxVal) * plotWidth;
        ctx.fillText(v.toString(), xPos, height - padding.bottom + 15);
    }

    ctx.fillText('Expected -log₁₀(P)', width/2, height - 5);
    ctx.save();
    ctx.translate(12, height/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillText('Observed -log₁₀(P)', 0, 0);
    ctx.restore();

    // Lambda annotation
    ctx.fillStyle = '#ff6b00';
    ctx.font = '11px JetBrains Mono';
    ctx.textAlign = 'left';
    ctx.fillText('λ_GC = 1.0425', padding.left + 10, padding.top + 20);
}

// Initialize on load
window.addEventListener('load', () => {
    drawManhattan();
    drawQQ();
});

// Redraw on resize
window.addEventListener('resize', () => {
    drawManhattan();
    drawQQ();
});
</script>

</body>
</html>
